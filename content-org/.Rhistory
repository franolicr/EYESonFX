bad
good - bad
bad <- 1
bad
good
good
bad
1 - 1
m$f$plt( tp= TRUE, j= 1, k= 1)
m$f$plt( tp= TRUE, j= 1, k= 1)
quartz()
 qplot( data= m$o$tr_fx[ typ= 1 & i== 1]
)
m$o$tr_fx[ typ= 1 & i== 1
]
m$o$tr_fx[ typ= 1 & i== 1]
m$o$tr_fx[ typ== 1 & i== 1]
qplot( data= m$o$tr_fx[ typ== 1 & i== 1], x= tm, y= N)
qplot( data= m$o$tr_fx[ typ== 1 & i== 1], x= tm, y= N, geom= "line"))
qplot( data= m$o$tr_fx[ typ== 1 & i== 1], x= tm, y= N, geom= "line")
qplot( data= m$o$tr_fx[ typ== 1 & i== 1], x= tm, y= N, geom= "line", colour= lbl)
qplot( data= m$o$tr_fx[ typ== 1 & i== 1], x= tm, y= N, geom= "line", group= lbl)
m$o$tr_fx
m$o$tr_fx[ lbl %in% c( "M", "T", "W", "F")]
m$o$tr_fx[ typ== 3][order( tm), .( N= mean( N)), .( tm, lbl)]
m$o$tr_fx[ typ== 3]
m$o$tr_fx[ typ== 3][order( tm), .( N= mean( N)), .( tm, lbl)]
m$o$tr_fx[ typ== 3]
m$o$tr_fx[ typ== 3][order( tm), .( N= mean( N)), .( tm, i2)]
qplot( data= m$o$tr_fx[ typ== 1 & i== 1], x= tm, y= N, geom= "line", colour= lbl)
qplot( data= m$o$tr_fx[ typ== 1 & i== 1], x= tm, y= N, geom= "line", colour= lbl) + scale_colour_grey()
?scale_colour_grey
qplot( data= m$o$tr_fx[ typ== 1 & i== 1], x= tm, y= N, geom= "line", colour= lbl)
qplot( data= m$o$tr_fx[ typ== 1 & i== 1], x= tm, y= N, geom= "line", group= lbl, colour= lbl)
quartz(); qplot( data= m$o$tr_fx[ typ== 1 & i== 1], x= tm, y= N, geom= "line", colour= lbl) + scale_colour_grey()
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
dev()
quartz(); qplot( data= m$o$tr_fx[ typ== 1 & i== 1], x= tm, y= N, geom= "line", group= lbl, colour= lbl) + scale_colour_grey()
j
k
?scale_colour_manual
m$o$tr_fx[ , lapply( .SD, class)]
m$o$tr_fx[ , .N, grp0]
m$o$tr_fx[ , .N, grp1]
i
j
k
class( m$o$plt1)
class( m$o$plt2)
class( m$o$plt2[[1]])
m$o$plt2
m$o$tr_fx[ order( typ, grp0, tm), .( i= 1:.N), .( typ, tm)]
m$o$bis[ lbl!= shift( lbl) & grp0== 1]
m$o$tr_fx[ lbl!= shift( lbl) & grp0== 1]
m$o$tr_fx[ typ== j][ lbl!= shift( lbl) & grp0== 1]
m$o$tr_fx[ typ== j]
m$o$tr_fx[ typ== j][ .( lbl, tm, grp0, max(N)][ lbl!= shift( lbl) & grp0== 1]
m$o$tr_fx[ typ== j][ , .( lbl, tm, grp0, max(N))][ lbl!= shift( lbl) & grp0== 1]
m$o$tr_fx[ typ== j][ lbl!= shift( lbl) & grp0== 1]
m$o$tr_fx[ typ== j][ , .( lbl, tm, grp0, N= max(N))][ lbl!= shift( lbl) & grp0== 1, .( tm, lbl, N)]
j
m$o$tr_fx[ typ== j][ , .( lbl, tm, grp0, N= max(N))][ lbl!= shift( lbl) & grp0== 1, .( tm, lbl, N)]
m$o$tr_fx[ typ== j][ , .( lbl, tm, grp0, N= max(N))]
m$o$tr_fx[ typ== j][ , .( lbl, tm, grp0, N= max(N))][ lbl!= shift( lbl) & grp0== min( grp0), .( tm, lbl, N)]
m$o$tr_fx[ typ== j][ , .( lbl, tm, grp0, N= max(N))][ lbl!= shift( lbl) & grp0== min( grp0), .( tm, lbl, N)]
?expansion
m$o$tr_fx[ typ== j][ k >= 998, .( lbl, tm, grp0, N= mean(N)), tm][
                                          lbl!= shift( lbl, fill= "") & grp0== min( grp0),
                                          .( tm, lbl, max( N))]
m$o$tr_fx[ typ== j][ , .( lbl, tm, grp0, N= mean(N)), tm][
                                          lbl!= shift( lbl, fill= "") & grp0== min( grp0),
                                          .( tm, lbl, max( N))]
ggplot() + theme_void() + annotate( geom= "rect", fill= m$p$drk_gry, alpha= 0.25, xmin= 0, xmax= 1, ymin= 0, ymax= 0)
quartz() ggplot() + theme_void() + annotate( geom= "rect", fill= m$p$drk_gry, alpha= 0.25, xmin= 0, xmax= 1, ymin= 0, ymax= 0)
quartz(); ggplot() + theme_void() + annotate( geom= "rect", fill= m$p$drk_gry, alpha= 0.25, xmin= 0, xmax= 1, ymin= 0, ymax= 0)
quartz(); ggplot() + theme_void() + annotate( geom= "rect", fill= m$p$drk_gry, alpha= 0.25, xmin= 0, xmax= 1, ymin= 0, ymax= 1)
quartz(); ggplot() + theme_void() + annotate( geom= "point", x= 0, y=0)
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
dev.off()
quartz(); ggplot() + theme_void() + annotate( geom= "rect", fill= m$p$drk_gry, alpha= 0.25, xmin= -Inf, xmax= +Inf, ymin= -Inf, ymax= +Inf)
dev.off()
quartz(); ggplot() + annotate( geom= "rect", fill= m$p$drk_gry, alpha= 0.25, xmin= -Inf, xmax= +Inf, ymin= -Inf, ymax= +Inf)
quartz(); ggplot() + annotate( geom= "rect", fill= m$p$drk_gry, alpha= 0.25, xmin= -Inf, xmax= +Inf, ymin= -Inf, ymax= +Inf) + theme_void()
quartz(); ggplot() + annotate( geom= "rect", fill= m$p$drk_gry, alpha= 0.25, xmin= -Inf, xmax= +Inf, ymin= -Inf, ymax= +Inf) + theme_void()
quartz(); ggplot() + annotate( geom= "rect", fill= m$p$drk_gry, alpha= 0.25, xmin= -Inf, xmax= +Inf, ymin= -Inf, ymax= +Inf)
m$p$drk_gry
m$o$tr_fx[ typ== j][ tp== TRUE & k< 998][ tm== max( tm), N, grp0]
tp == TRUE
tp <- TRUE
m$o$tr_fx[ typ== j][ tp== TRUE & k< 998][ tm== max( tm), N, grp0]
m$o$tr_fx[ typ== j][ tp== TRUE & k< 998]
k
k <- 1
m$o$tr_fx[ typ== j][ tp== TRUE & k< 998]
m$o$tr_fx[ typ== j][ tp== TRUE & k< 998][ tm== max( tm), N, grp0]
m$o$tr_fx[ typ== j][ tp== TRUE & k< 998][ tm== max( tm), .( N, i), grp0]
m$o$tr_fx[ typ== j][ tp== TRUE & k< 998][, .( N, i), grp0]
k
j
m$o$tr_fx[ typ== j][ tp== TRUE & k< 998][, .( N, i), grp0]
m$o$tr_fx[ typ== j]x[ tp== TRUE & k< 998][ tm== max( tm), .( tm, N, i), grp0]
m$o$tr_fx[ typ== j][ tp== TRUE & k< 998][ tm== max( tm), .( tm, N, i), grp0]
m$o$tr_fx[ typ== j][ tp== TRUE & k< 998][ tm== max( tm), .( tm, N, i), grp0]
k
k
m$o$tr_fx[ typ== j][ tp== TRUE & k< 998][ tm== max( tm), .( tm, N, i), grp0]
m$o$bis
m$o$tr_fx[ typ= 4]
m$o$tr_fx[ typ== 4]
m$o$tr_fx[ typ== 4][ grp0== min( grp0)]
m$o$tr_fx[ typ== 4][ grp0== min( grp0) & tm %in% c( 7, ]
m$o$tr_fx[ typ== 4][ grp0== min( grp0)]
m$x$tr_fx$mntly[ , .( N= sum( N), N0= sum( N0)),
		    .( lbl= strftime( tm, "%H", tz= "Europe/London"), tm= as.numeric( floor_date( tm, "15 minute")),
		      grp1= hour( tm), grp0= wrk_dy_mnth)]
m$x$tr_fx$mntly[ , .( N= sum( N), N0= sum( N0)),
		    .( tm, lbl= strftime( tm, "%H", tz= "Europe/London"), tm= as.numeric( floor_date( tm, "15 minute")),
		      grp1= hour( tm), grp0= wrk_dy_mnth)]
m$x$tr_fx$mntly[ , .( N= sum( N), N0= sum( N0)),
		    .( tm, lbl= strftime( tm, "%H", tz= "Europe/London"), tm= as.numeric( floor_date( tm, "15 minute")),
		      grp1= hour( tm), grp0= wrk_dy_mnth)][ order( tm)]
m$x$tr_fx$mntly[ , .( N= sum( N), N0= sum( N0)),
		    .( tm, lbl= strftime( tm, "%H", tz= "GMT"), tm= as.numeric( floor_date( tm, "15 minute")),
		      grp1= hour( tm), grp0= wrk_dy_mnth)][ order( tm)]
m$x$tr_fx$mntly[ , .( N= sum( N), N0= sum( N0)),
		    .( tm, lbl= strftime( tm, "%H", tz= "Europe/London"), tm= as.numeric( floor_date( tm, "15 minute")),
		      grp1= hour( tm), grp0= wrk_dy_mnth)][ order( tm)]
POSIXct(0)
POSIXct()
as.POSIXct()
as.POSIXct(0)
as.POSIXct(0, origin= "1970-01-01"))
as.POSIXct(0, origin= "1970-01-01")
as.POSIXct(0, origin= "1970-01-01", tz= "Europe/London")
as.POSIXct( "1970-01-01 07:00", tz= "Europe/London")
as.POSIXct(  "1970-01-01 07:00", "1970-01-01 07:00", "1970-01-01 13:00", "1970-01-01 16:00", tz= "Europe/London")
as.POSIXct( c( "1970-01-01 07:00", "1970-01-01 07:00", "1970-01-01 13:00", "1970-01-01 16:00"), tz= "Europe/London")
m$o$tr_fx[ typ== 4][ grp0== min( grp0) & tm %in% as.numeric( floor_date( as.POSIXct( c( "1970-01-01 07:00", "1970-01-01 07:00", "1970-01-01 13:00", "1970-01-01 16:00"), tz= "Europe/London"), "15 minute"))]
m$o$tr_fx[ typ== 4][ grp0== min( grp0) & tm %in% as.numeric( floor_date( as.POSIXct( c( "1970-01-01 07:00", "1970-01-01 13:00", "1970-01-01 16:00"), tz= "Europe/London"), "15 minute"))]
m$o$tr_fx[ typ== 4 & grp0== min( grp0) & tm %in% as.numeric( floor_date( as.POSIXct( c( "1970-01-01 07:00", "1970-01-01 13:00", "1970-01-01 16:00"), tz= "Europe/London"), "15 minute"))]
m$o$tr_fx[ typ== 4 & tm %in% as.numeric( floor_date( as.POSIXct( c( "1970-01-01 07:00", "1970-01-01 13:00", "1970-01-01 16:00"), tz= "Europe/London"), "15 minute")), flg:= "green"]
m$o$tr_fx[ typ== j][ tp== TRUE,
                                           .( frst_grp0= min( grp0), grp0, clr, tm), .( lbl)][ frst_grp0== grp0]
m$o$tr_fx[ typ== j][ tp== TRUE & !is.na( clr),
                                           .( frst_grp0= min( grp0), grp0, clr, tm), .( lbl)][ frst_grp0== grp0]
m$o$tr_fx[ typ== j][ tp== TRUE & !is.na( clr),
                                           .( frst_grp0= min( grp0), grp0, clr, tm), .( lbl)][ frst_grp0== grp0]
m$o$tr_fx[ , .N, grp1]
m$o$tr_fx[ , .N, .( grp1, id2)]
m$o$tr_fx[ , .N, .( grp1, i2)]
m$o$tr_fx[ , .N, .( grp1, i2)][ , .N, .( grp1)] 
m$o$tr_fx[ , .N, .( grp1, i2)][ , .N, .( grp1)][ N>1]
?switch
switch( 1, "grey20", "grey40", "black")
switch( 1, "grey20", "grey40", default= "black")
switch( 5, "grey20", "grey40", default= "black")
switch( 3, "grey20", "grey40", default= "black")
switch( 4, "grey20", "grey40", default= "black")
m$o$tr_fx[ , .N, .( grp0, i)]
m$o$tr_fx[ , .N, .( grp0)]
m$o$tr_fx[ , .N, .( grp0)]
m$o$tr_fx[ , .N, .( i)]
m$o$tr_fx[ , .N, .( grp0, i)]
i
j
k
j
k
tp
tp <- FALSE
k
m$o$tr_fx[ typ== j][ tp== FALSE][ order( tm), .( N= mean( N)), .( tm, i2)]]
tp
m$o$tr_fx[ typ== j][ tp== FALSE][ order( tm), .( N= mean( N)), .( tm, i2)]
c( "grey80", "grey50", rep( "grey20", 100))[ 0]
m$o$tr_fx[ i2== 0]
m$o$tr_fx[ i2== 0]
m$o$tr_fx[ i2== 0]
m$o$tr_fx[ , .N, i2]
m$o$tr_fx[ , .N, i2]
j
k
m$o$tr_Fx
m$o$tr_fx
m$o$tr_fx[ typ== 1]
m$o$tr_fx[ typ== 2]
m$o$tr_fx[ typ== 3]
m$o$tr_fx[ typ== 3]
m$o$tr_fx[ typ== 3]
i <- 3
tp <- TRUE
k<- 999
m$o$tr_fx[ tp== FALSE | k > 998, .( lbl, tm, grp1, N= mean(N)), tm][
                                          lbl!= shift( lbl, fill= "") & grp1== min( grp1),
                                          .( tm, lbl, N= max( N))]
m$o$tr_fx[ tp== FALSE | k > 998, .( lbl, tm, grp1, N= mean(N)), tm]
m$o$tr_fx[ tp== FALSE | k > 998, .( lbl, tm, grp1, N= mean(N)), tm][
                                          lbl!= shift( lbl, fill= "") & grp1== min( grp1),
                                          .( tm, lbl, N= max( N))]
m$o$tr_fx[ tp== FALSE | k > 998, .( lbl, tm, grp1, N= mean(N)), tm][
                                          lbl!= shift( lbl, fill= "") & grp1== min( grp1),
                                          .( tm, lbl, N= max( N))]
k
m$o$tr_fx[ tp== FALSE | k > 998, .( lbl, tm, grp1, N= mean(N)), tm]
m$o$tr_fx[ tp== FALSE | k > 998, .( lbl, tm, grp1, N= mean(N)), tm][
                                          lbl!= shift( lbl, fill= "") & grp1== min( grp1),
                                          .( tm, lbl, N= max( N))]
tp
i
m$o$tr_fx[ typ== i]tp== FALSE | k > 998, .( lbl, tm, grp1, N= mean(N)), tm][
                                          lbl!= shift( lbl, fill= "") & grp1== min( grp1),
                                          .( tm, lbl, N= max( N))]
m$o$tr_fx[ typ== i][tp== FALSE | k > 998, .( lbl, tm, grp1, N= mean(N)), tm][
                                          lbl!= shift( lbl, fill= "") & grp1== min( grp1),
                                          .( tm, lbl, N= max( N))]
i
i
j <- 3
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, tm, grp1, N= mean(N)), tm][
                                          lbl!= shift( lbl, fill= "") & grp1== min( grp1),
                                          .( tm, lbl, N= max( N))]
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, tm, grp1, N= mean(N)), tm][
                                          lbl!= shift( lbl, fill= "") & grp1== min( grp1),
                                          .( tm, lbl, N= max( N))][ order( tm)]
j <- 4
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, tm, grp1, N= mean(N)), tm][
                                          lbl!= shift( lbl, fill= "") & grp1== min( grp1),
                                          .( tm, lbl, N= max( N))][ order( tm)]
j <- 3
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, tm, grp1, N= mean(N)), tm][
                                          lbl!= shift( lbl, fill= "") & grp1== min( grp1),
                                          .( tm, lbl, N= max( N))][ order( tm)]
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, tm, grp1, N= mean(N)), tm][
                                          lbl!= shift( lbl, fill= ""),
                                          .( tm, lbl, N= max( N))][ order( tm)]
j <- 4
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, tm, grp1, N= mean(N)), tm][
                                          lbl!= shift( lbl, fill= ""),
                                          .( tm, lbl, N= max( N))][ order( tm)]
j <- 2
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, tm, grp1, N= mean(N)), tm][
                                          lbl!= shift( lbl, fill= ""),
                                          .( tm, lbl, N= max( N))][ order( tm)]
j <- 5
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, tm, grp1, N= mean(N)), tm][
                                          lbl!= shift( lbl, fill= ""),
                                          .( tm, lbl, N= max( N))][ order( tm)]
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, tm, grp1, N= mean(N)), tm][

                                          lbl!= shift( lbl, fill= ""),
                                          .( tm, lbl, N= max( N))][ order( tm)]
j

                                          lbl!= shift( lbl, fill= ""),
                                          .( tm, lbl, N= max( N))][ order( tm)]
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, tm, grp1, N= mean(N)), tm][
                                          lbl!= shift( lbl, fill= ""),
                                          .( tm, lbl, N= max( N))][ order( tm)]
j <- 4
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, tm, grp1, N= mean(N)), tm][
                                          lbl!= shift( lbl, fill= ""),
                                          .( tm, lbl, N= max( N))][ order( tm)]
j <- 3
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, tm, grp1, N= mean(N)), tm][
                                          lbl!= shift( lbl, fill= ""),
                                          .( tm, lbl, N= max( N))][ order( tm)]
j <- 2
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, tm, grp1, N= mean(N)), tm][
                                          lbl!= shift( lbl, fill= ""),
                                          .( tm, lbl, N= max( N))][ order( tm)]
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, tm, N= mean(N)), tm]
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, tm, N= mean(N)), tm]
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, tm, N= mean(N)), tm][ , .( tm), .( lbl)]
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, tm, N= mean(N)), tm][ , .( min( tm)), .( lbl)]
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, tm, N= mean(N)), tm][ , .( tm= min( tm), N), .( lbl)]
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, tm, N= mean(N)), tm][ , .( mn_tm= min( tm), N), .( lbl)][ tm== mn_tm]
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, tm, N= mean(N)), tm][ , .( mn_tm= min( tm), tm, N), .( lbl)][ tm== mn_tm]
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, tm, N= mean(N)), tm][ , .( mn_tm= min( tm), tm, N), .( lbl)][ ,.( tm= max( tm), N= max( N)), lbl]
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, tm, N= mean(N)), tm][ , .( mn_tm= min( tm), tm, max( N)), .( lbl)][ ,.( tm= max( tm), N= max( N)), lbl]
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, tm, N= mean(N)), tm][ , .( mn_tm= min( tm), tm, N= max( N)), .( lbl)][ ,.( tm= max( tm), N= max( N)), lbl]
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, tm, N= mean(N)), tm][ , .( mn_tm= min( tm), tm, N= max( N)), .( lbl)][ ,.( tm= max( tm), N= max( N)), lbl][ , .( lbl, tm, max( N)]
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, tm, N= mean(N)), tm][ , .( mn_tm= min( tm), tm, N= max( N)), .( lbl)][ ,.( tm= max( tm), N= max( N)), lbl][ , .( lbl, tm, max( N))]
j <- 2
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, tm, N= mean(N)), tm][ , .( mn_tm= min( tm), tm, N= max( N)), .( lbl)][ ,.( tm= max( tm), N= max( N)), lbl][ , .( lbl, tm, max( N))]
j <- 3
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, tm, N= mean(N)), tm][ , .( mn_tm= min( tm), tm, N= max( N)), .( lbl)][ ,.( tm= max( tm), N= max( N)), lbl][ , .( lbl, tm, max( N))]
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, tm, N= mean(N)), tm][ , .( mn_tm= min( tm), tm, N= max( N)), .( i2)][ ,.( tm= max( tm), N= max( N)), i2][ , .( lbl, tm, max( N))]
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, i2, tm, N= mean(N)), tm][ , .( mn_tm= min( tm), tm, N= max( N)), .( i2)][ ,.( tm= max( tm), lbl= max( lbl), N= max( N)), i2][ , .( lbl, tm, max( N))]
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, i2, tm, N= mean(N)), tm][ , .( mn_tm= min( tm), lbl, tm, N= max( N)), .( i2)][ ,.( tm= max( tm), lbl= max( lbl), N= max( N)), i2][ , .( lbl, tm, max( N))]
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, i2, tm, N= mean(N)), tm][ , .( mn_tm= min( tm), lbl, tm, N= max( N)), .( i2)][ ,.( tm= max( tm), lbl= max( lbl), N= max( N)), i2][ , .( lbl, tm, max( N))][ order( tm)]
j <- 3
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, i2, tm, N= mean(N)), tm][ , .( mn_tm= min( tm), lbl, tm, N= max( N)), .( i2)][ ,.( tm= max( tm), lbl= max( lbl), N= max( N)), i2][ , .( lbl, tm, max( N))][ order( tm)]
j <- 2
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, i2, tm, N= mean(N)), tm][ , .( mn_tm= min( tm), lbl, tm, N= max( N)), .( i2)][ ,.( tm= max( tm), lbl= max( lbl), N= max( N)), i2][ , .( lbl, tm, max( N))][ order( tm)]
j <- 4
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, i2, tm, N= mean(N)), tm][ , .( mn_tm= min( tm), lbl, tm, N= max( N)), .( i2)][ ,.( tm= max( tm), lbl= max( lbl), N= max( N)), i2][ , .( lbl, tm, max( N))][ order( tm)]
j <- 5
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, i2, tm, N= mean(N)), tm][ , .( mn_tm= min( tm), lbl, tm, N= max( N)), .( i2)][ ,.( tm= max( tm), lbl= max( lbl), N= max( N)), i2][ , .( lbl, tm, max( N))][ order( tm)]
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, i2, tm, N= mean(N)), tm][ , .( mn_tm= min( tm), lbl, tm, N= max( N)), .( i2)][ ,.( tm= max( tm), lbl= max( lbl), N= max( N)), i2][ , .( lbl, tm, max( N))][ order( tm)]
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, i2, tm, N= mean(N)), tm][ , .( mn_tm= min( tm), lbl, tm, N= max( N)), .( i2)][ ,.( tm= max( tm), lbl= max( lbl), N= max( N)), i2][ , .( lbl, tm, max( N))][ order( tm)]
j <- 3
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, i2, tm, N= mean(N)), tm][ , .( mn_tm= min( tm), lbl, tm, N= max( N)), .( i2)][ ,.( tm= max( tm), lbl= max( lbl), N= max( N)), i2][ , .( lbl, tm, max( N))][ order( tm)]
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, i2, tm, N= mean(N)), tm][ , .( mn_tm= min( tm), lbl, tm, N= max( N)), .( i2)][ ,.( tm= max( tm), lbl= max( lbl), N= max( N)), i2][ , .( lbl, tm, max( N))][ order( tm)]a
j <- 2
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, i2, tm, N= mean(N)), tm][ , .( mn_tm= min( tm), lbl, tm, N= max( N)), .( i2)][ ,.( tm= max( tm), lbl= max( lbl), N= max( N)), i2][ , .( lbl, tm, max( N))][ order( tm)]a
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, i2, tm, N= mean(N)), tm][ , .( mn_tm= min( tm), lbl, tm, N= max( N)), .( i2)][ ,.( tm= max( tm), lbl= max( lbl), N= max( N)), i2][ , .( lbl, tm, max( N))][ order( tm)]a
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, i2, tm, N= mean(N)), tm][ , .( mn_tm= min( tm), lbl, tm, N= max( N)), .( i2)][ ,.( tm= max( tm), lbl= max( lbl), N= max( N)), i2][ , .( lbl, tm, max( N))][ order( tm)]
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, i2, tm, N= mean(N)), tm]
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, i2, tm, N= mean(N)), tm][ , .( mn_tm= min( tm), lbl, tm, N= max( N)), .( i2)][ ,.( tm= min( tm), lbl= max( lbl), N= max( N)), i2][ , .( lbl, tm, max( N))][ order( tm)]
j <- 4
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, i2, tm, N= mean(N)), tm][ , .( mn_tm= min( tm), lbl, tm, N= max( N)), .( i2)][ ,.( tm= min( tm), lbl= max( lbl), N= max( N)), i2][ , .( lbl, tm, max( N))][ order( tm)]
j <- 5
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, i2, tm, N= mean(N)), tm][ , .( mn_tm= min( tm), lbl, tm, N= max( N)), .( i2)][ ,.( tm= min( tm), lbl= max( lbl), N= max( N)), i2][ , .( lbl, tm, max( N))][ order( tm)]
m$o$tr_fx[ typ== j][ tp== TRUE & k <= 998, .( lbl, tm, grp1, N= max(N))][
                                          lbl!= shift( lbl, fill= ""),
                                          .( tm, lbl, N= max( N))]
m$o$tr_fx[ typ== j][ tp== TRUE & k <= 998, .( lbl, tm, grp1, N= max(N))][
                                          lbl!= shift( lbl, fill= ""),
                                          .( tm, lbl, N= max( N))]
tp
k
k <- 1
m$o$tr_fx[ typ== j][ tp== TRUE & k <= 998, .( lbl, tm, grp1, N= max(N))][
                                          lbl!= shift( lbl, fill= ""),
                                          .( tm, lbl, N= max( N))]
m$o$tr_fx[ typ== j][ tp== TRUE & k <= 998, .( lbl, grp1, N= max(N)), tm][
                                          lbl!= shift( lbl, fill= ""),
                                          .( tm, lbl, N= max( N))]
m$o$tr_fx[ typ== j][ tp== TRUE & k <= 998, .( lbl, grp1, N= max(N)), tm]
m$o$tr_fx[ typ== j][ tp== TRUE & k <= 998, .( lbl, grp1, N= max(N)), tm][ , .( tm= min( tm), N= max( N)), lbl]
m$o$tr_fx[ typ== j][ tp== TRUE & k <= 998, .( lbl, grp1, N= max(N)), tm][ , .( tm= min( tm), N= max( N)), lbl]
j <- 5
m$o$tr_fx[ typ== j][ tp== TRUE & k <= 998, .( lbl, grp1, N= max(N)), tm][ , .( tm= min( tm), N= max( N)), lbl]
j <- 4
m$o$tr_fx[ typ== j][ tp== TRUE & k <= 998, .( lbl, grp1, N= max(N)), tm][ , .( tm= min( tm), N= max( N)), lbl]
j <- 3
m$o$tr_fx[ typ== j][ tp== TRUE & k <= 998, .( lbl, grp1, N= max(N)), tm][ , .( tm= min( tm), N= max( N)), lbl]
m$o$tr_fx[ typ== j][ tp== TRUE & k <= 998, .( lbl, grp1, N= max(N)), tm][ , .( tm= min( tm), N= max( N), lbl= max( lbl), i2]
m$o$tr_fx[ typ== j][ tp== TRUE & k <= 998, .( lbl, grp1, N= max(N)), tm][ , .( tm= min( tm), N= max( N), lbl= max( lbl)), i2]
m$o$tr_fx[ typ== j][ tp== TRUE & k <= 998, .( lbl, i2, grp1, N= max(N)), tm][ , .( tm= min( tm), N= max( N), lbl= max( lbl)), i2]
m$o$tr_fx[ typ== j][ tp== TRUE & k <= 998, .( lbl, i2, grp1, N= max(N)), tm][ , .( tm= min( tm), N= max( N), lbl= max( lbl)), i2]
j <- 5
m$o$tr_fx[ typ== j][ tp== TRUE & k <= 998, .( lbl, i2, grp1, N= max(N)), tm][ , .( tm= min( tm), N= max( N), lbl= max( lbl)), i2]
j <- 4
m$o$tr_fx[ typ== j][ tp== TRUE & k <= 998, .( lbl, i2, grp1, N= max(N)), tm][ , .( tm= min( tm), N= max( N), lbl= max( lbl)), i2]
j <- 3
m$o$tr_fx[ typ== j][ tp== TRUE & k <= 998, .( lbl, i2, grp1, N= max(N)), tm][ , .( tm= min( tm), N= max( N), lbl= max( lbl)), i2]
j <- 2
m$o$tr_fx[ typ== j][ tp== TRUE & k <= 998, .( lbl, i2, grp1, N= max(N)), tm][ , .( tm= min( tm), N= max( N), lbl= max( lbl)), i2]
m$o$tr_fx[ typ== j][ tp== TRUE & k <= 998, .( lbl, i2, grp1, N= max(N)), tm][ , .( tm= min( tm), N= max( N), lbl= max( lbl)), i2]
j <- 3
k <- 998
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, i2, tm, N= mean(N)), tm][
              , .( mn_tm= min( tm), lbl, tm, N= max( N)), .( i2)][
               ,.( tm= min( tm), lbl= max( lbl), N= max( N)), i2][
              , .( lbl, tm, N= max( N))][ order( tm)]
tp= TRUE
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, i2, tm, N= mean(N)), tm][
              , .( mn_tm= min( tm), lbl, tm, N= max( N)), .( i2)][
               ,.( tm= min( tm), lbl= max( lbl), N= max( N)), i2][
              , .( lbl, tm, N= max( N))][ order( tm)]
j
k
k <- 999
m$o$tr_fx[ typ== j][tp== FALSE | k > 998, .( lbl, i2, tm, N= mean(N)), tm][
              , .( mn_tm= min( tm), lbl, tm, N= max( N)), .( i2)][
               ,.( tm= min( tm), lbl= max( lbl), N= max( N)), i2][
              , .( lbl, tm, N= max( N))][ order( tm)]
k <- 998
tp <- TRUE
m$o$tr_fx[ typ== j][ tp== TRUE & k <= 998, .( lbl, i2, grp1, N= max(N)), tm][
                                        , .( tm= min( tm), N= max( N), lbl= max( lbl)), i2][
                                         , .( tm, lbl, N= max( N))]
m$p$estrs
 week( as.Date( m$p$estrs)
)
mean( week( as.Date( m$p$estrs))
)
round( mean( week( as.Date( m$p$estrs))))
m$o$tr_fx[ typ== 2]
install.packages( "timeDate")
library( timeDate)
listHolidays
listHolidays()
holidayLONDON( year= 2010:2019)
class( holidayLONDON( year= 2010:2019))
week( holidayLONDON( year= 2010:2019))
table( week( holidayLONDON( year= 2010:2019)))
table( week( holidayLONDON( year= 2010:2019)))
 week( as.Date( m$p$estrs))
table( week( holidayLONDON( year= 2010:2019)))
 as.data.table( table( week( holidayLONDON( year= 2010:2019)))
)
m$p$hlds <-  as.data.table( table( week( holidayLONDON( year= 2010:2019))))
m$p$hldys
m$p$hlds <-  as.data.table( table( week( holidayLONDON( year= 2010:2019))))
m$p$hldys <-  as.data.table( table( week( holidayLONDON( year= 2010:2019))))
m$p$hldys
]
m$p$hlds <- NULL
m$p$hldys
m$p$hldys[ , sum( N), hldy]
m$p$hldys[ , .( sum( N), mean( wk)), hldy]
m$p$hldys[ , .( sum( N), mean( as.numeric( wk))), hldy]
m$p$hldys[ , .( sum( N), mean( wk= as.numeric( wk))), hldy][ , round( wk)] 
m$p$hldys[ , .( sum( N), wk= mean( as.numeric( wk))), hldy][ , round( wk)] 
m$x$tr_fx$mntly
m$x$tr_fx$dly
list.files( path= "/Dnk/Srcs/Tr_FX/Smry/")
grepl( "*.csv", list.files( path= "/Dnk/Srcs/Tr_FX/Smry/"))
list.files( path= "/Dnk/Srcs/Tr_FX/Smry/")[ grepl( "*.csv", list.files( path= "/Dnk/Srcs/Tr_FX/Smry/"))]
list.files( path= "/Dnk/Srcs/Tr_FX/Smry/")[ grepl( "*.csv", list.files( path= "/Dnk/Srcs/Tr_FX/Smry/"))]
list.files( path= "/Dnk/Srcs/Tr_FX/Smry/", full.names= TRUE)[ grepl( "*.csv", list.files( path= "/Dnk/Srcs/Tr_FX/Smry/"))]
list.files( path= "/Dnk/Srcs/Tr_FX/Smry/", full.names= TRUE)[ grepl( "*.csv", list.files( path= "/Dnk/Srcs/Tr_FX/Smry/"))][1]
fl
which( fl %in% m$p$fls)
m$x$tr_fx$dly
rbindlist( m$x$tr_fx$dly)
m$tr_fx$dly
fl
m$p$fls
which( fl %in% m$p$fls)
which( m$p$fls %in% fl)
m$x$tr_fx$mntly
m$x$tr_fx$dly
m$x$tr_fx$mntly
m$x$tr_fx$mntly
m$x$tr_fx$mntly[ , .N, crncy]
m$x$tr_fx$mntly[ , .N, crnc]
m$x$tr_fx$dly[ , .N, crnc]
m$p$hldys
34 + 35
(34 + 35)/2
round( (34 + 35)/2)
round( (34 + 35)/2.0)
 (34 + 35)/2.0
round( (34 + 35)/2.0)
round( (34 + 35.5)/2.0)
round( (34.0 + 35.0)/2.0)
round( (34.0 + 35.0)/2.0, digits= 1)
round( (34.0 + 35.0)/2.0, digits= 0)
m$x$tr_fx$mntly[ , .( sum( N)), floor_date( tm, "month")]
m$x$tr_fx$mntly[ , .( sum( N)), floor_date( dt, "month")]
m$x$tr_fx$mntly
m$x$tr_fx$dly[ , .( sum( N)), floor_date( dt, "month")]
m$x$tr_fx$dly
m$x$tr_fx$dly[ , .( sum( N)), floor_date( fx_dy, "month")]
m$x$tr_fx$dly[ , .( sum( N)), .( crcn, mnth= floor_date( fx_dy, "month"))]
m$x$tr_fx$dly[ , .( sum( N)), .( crcn, mnth= floor_date( fx_dy, "month"))]
m$x$tr_fx$dly[ , .( sum( N)), .( crnc, mnth= floor_date( fx_dy, "month"))]
dev.list
dev.list()
dev.off( dev.list()); quartz()
dev.off( dev.list())
dev.list()
dev.off( dev.list())
 dev.list()
lapply( dev.list(), dev.off); quartz()
lapply( dev.list(), dev.off); quartz()
lapply( dev.list(), dev.off); quartz()
lapply( dev.list(), dev.off); quartz()
lapply( dev.list(), dev.off); quartz(); qplot( data= quartm$x$tr_fx$dly[ , .( N= sum( N)), .( crnc, mnth= floor_date( fx_dy, "month"))], x= mnth, y= N) + facet_wrap( "crncy", ncol= 4)
lapply( dev.list(), dev.off); quartz(); qplot( data= m$x$tr_fx$dly[ , .( N= sum( N)), .( crnc, mnth= floor_date( fx_dy, "month"))], x= mnth, y= N) + facet_wrap( "crncy", ncol= 4)
lapply( dev.list(), dev.off); quartz(); qplot( data= m$x$tr_fx$dly[ , .( N= sum( N)), .( crnc, mnth= floor_date( fx_dy, "month"))], x= mnth, y= N) + facet_wrap( "crnc", ncol= 4)
lapply( dev.list(), dev.off); quartz(); qplot( data= m$x$tr_fx$dly[ , .( N= sum( N)), .( crnc, mnth= floor_date( fx_dy, "month"))], x= mnth, y= N, geom= "line") + facet_wrap( "crnc", ncol= 4)
lapply( dev.list(), dev.off); quartz(); qplot( data= m$x$tr_fx$dly[ year( fx_dy) %in% c( 2012, 2013), .( N= sum( N)), .( crnc, mnth= floor_date( fx_dy, "month"))], x= mnth, y= N, geom= "line") + facet_wrap( "crnc", ncol= 4)
lapply( dev.list(), dev.off); quartz(); qplot( data= m$x$tr_fx$dly[ year( fx_dy) %in% c( 2012, 2013, 2014), .( N= sum( N)), .( crnc, mnth= floor_date( fx_dy, "day"))], x= mnth, y= N, geom= "line") + facet_wrap( "crnc", ncol= 4)
lapply( dev.list(), dev.off); quartz(); qplot( data= m$x$tr_fx$dly[ year( fx_dy) %in% c( 2010:2019), .( N= sum( N)), .( crnc, mnth= floor_date( fx_dy, "week"))], x= mnth, y= N, geom= "line") + facet_wrap( "crnc", ncol= 4)
lapply( dev.list(), dev.off); quartz(); qplot( data= m$x$tr_fx$dly[ year( fx_dy) %in% c( 2010:2019), .( N= sum( N)), .( crnc, mnth= floor_date( fx_dy, "week"))], x= mnth, y= N, geom= "line") + facet_wrap( "crnc", ncol= 4) + scale_x_date( breaks= 2010:2019)
lapply( dev.list(), dev.off); quartz(); qplot( data= m$x$tr_fx$dly[ year( fx_dy) %in% c( 2010:2019), .( N= sum( N)), .( crnc, mnth= floor_date( fx_dy, "week"))], x= mnth, y= N, geom= "line") + facet_wrap( "crnc", ncol= 4) + scale_x_date( data_breaks= "year")
lapply( dev.list(), dev.off); quartz(); qplot( data= m$x$tr_fx$dly[ year( fx_dy) %in% c( 2010:2019), .( N= sum( N)), .( crnc, mnth= floor_date( fx_dy, "week"))], x= mnth, y= N, geom= "line") + facet_wrap( "crnc", ncol= 4) + scale_x_date( date_breaks= "year")
lapply( dev.list(), dev.off); quartz(); qplot( data= m$x$tr_fx$dly[ year( fx_dy) %in% c( 2010:2019), .( N= sum( N)), .( crnc, mnth= floor_date( fx_dy, "week"))], x= mnth, y= N, geom= "line") + facet_wrap( "crnc", ncol= 4) + scale_x_date( date_breaks= "year", date_labels= "%y"))
lapply( dev.list(), dev.off); quartz(); qplot( data= m$x$tr_fx$dly[ year( fx_dy) %in% c( 2010:2019), .( N= sum( N)), .( crnc, mnth= floor_date( fx_dy, "week"))], x= mnth, y= N, geom= "line") + facet_wrap( "crnc", ncol= 4) + scale_x_date( date_breaks= "year", date_labels= "%y")
lapply( dev.list(), dev.off); quartz(); qplot( data= m$x$tr_fx$dly[ year( fx_dy) %in% c( 2010:2019), .( N= sum( N)), .( crnc, mnth= floor_date( fx_dy, "week"))], x= mnth, y= N, geom= "line") + facet_wrap( "crnc", ncol= 4) + scale_x_date( date_breaks= "year", date_labels= "%y")
m$p$hldys
m$p$hldys[ , .( sum( N), wk= mean( as.numeric( wk))), hldy][ , ( wk)
]
