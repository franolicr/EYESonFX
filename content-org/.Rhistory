m$i$bis
m$i$bis[ yr== 2019]
m$i$bis[ yr== max( yr]
m$i$bis[ yr== max( yr)]
m$i$bis[ yr== max( yr)][ , sum( vl), crncy1]
m$i$bis[ yr== max( yr)][ , sum( vl), crncy1]
m$i$bis[ yr== max( yr)]
m$i$bis[ yr== max( yr)][ , .( sum( vl), .( crncy2)]
m$i$bis[ yr== max( yr)][ , .( sum( vl)), .( crncy2)]
m$i$bis[ yr== max( yr)][ , .( vl= sum( vl)), .( crncy2)][ , .( crncy2, vl/sum( vl))]
m$i$bis[ yr== max( yr)][ , .( vl= sum( vl)), .( crncy2)][ , .( crncy2, vl/sum( vl))]
m$i$bis[ , .( vl, sum( vl)), crncy2]
m$i$bis[ , crncy2_x := sum( vl)), crncy2]
m$i$bis[ , crncy2_x := sum( vl), crncy2]
m$i$bis
m$i$bis
m$i$bis
m$x$bis
qplot( m$i$bis, x= crncy2_x, y= crncy2_y)
library( ggplot2)
qplot( m$i$bis, x= crncy2_x, y= crncy2_y)
qplot( data= m$i$bis, x= crncy2_x, y= crncy2_y)
qplot( data= m$i$bis, x= crncy2_x, y= crncy1_y)
m$i$bis[ , .N, .( crncy1_y, crncy1)]
m$i$bis[ , .N, .( crncy2_x, crncy2)]
m$i$bis
m$i$bis
m$i$bis
m$i$bis[ , .( sum( value)), crncy2]
m$i$bis[ , .( sum( vl)), crncy2]
m$i$bis[ , .( sum( vl)), crncy2][ , cumsum( vl)- vl]
m$i$bis[ , .( vl= sum( vl)), crncy2][ , cumsum( vl)- vl]
m$i$bis[ , .( vl= sum( vl)), crncy2][ , .( cumsum( vl))- vl]
m$i$bis[ , .( vl= sum( vl)), crncy2][ , .( cumsum( vl)- vl)]
m$x$crncy_x <- m$i$bis[ , .( vl= sum( vl)), crncy2][ , .( cumsum( vl)- vl)]
m$x$crncy_x
m$x$crncy_x
 m$i$bis[ yr== max( yr), .( vl= sum( vl)), crncy1][ , .( cumsum( vl)- vl)]
m$x$crncy_x
 m$i$bis[ yr== max( yr), .( vl= sum( vl)), crncy1][ , .( cumsum( vl)- vl)]
 m$i$bis[ yr== max( yr), .( vl= sum( vl)), crncy1][ , .( cumsum( vl)- vl, crncy1)]
m$x$bis
qplot( data= m$x$bis, x= crncy_x, y= crncy_y)
m$x$bis
m$x$bis
m$x$bis
qplot( data= m$x$bis, x= crncy_x, y= crncy_y)
qplot( data= m$x$bis, x= crncy_x, y= crncy_y, label= paste( crncy1, crncy2))
)
)
quartz()
m$x$crncy_x
m$x$crncy_
m$x$crncy_x
m$x$crncy_y
m$x$bis
m$x$bis
m$x$bis
m$i$bis
m$i$bis[ yr== 2019 & crncy2== "USD"]
m$i$bis[ yr== 2019 & crncy1== "USD"]
m$x$bis
m$o$bis
m$o$bis
m$o$bis[ yr== 2019, crcny2== "USD"]
m$o$bis[ yr== 2019 & crcny2== "USD", .N, crcny1]
m$o$bis[ yr== 2019 & crncy2== "USD", .N, crcny1]
m$o$bis[ yr== 2019 & crncy2== "USD", .N, crncy1]
m$o$bis[ yr== 2019 & crncy2== "T01", .N, crncy1]
m$o$bis[ yr== 2019 & crncy2== "TO1", .N, crncy1]
m$o$bis
m$i$bis[ yr== 2019, sum( vl), crncy1]
m$i$bis[ yr== 2019, .( vl= sum( vl)), crncy1][ vl == 0] 
m$i$bis[ yr== 2019, sum( vl), crncy2]
m$i$bis
m$i$bis
m$i$bis[ yr== 2019, .( vl= sum( vl)), crncy1][ vl == 0, crncy1]
m$i$bis
m$i$bis
m$i$bis[ crncy1== "DEM"]
m$i$bis[ crncy1== "DEM"]
m$i$bis[ crncy1== "FRF"]
m$i$bis[ crncy2== "FRF"]
m$i$bis[ crncy2== "DEM"]
m$i$bis
m$i$bis[ crncy1== "DEM"]
m$i$bis[ crncy1== "FRF"]
m$i$bis
m$i$bis[ DER_CURR_LEG1== "DEM"]
m$i$bis[ DER_CURR_LEG1== "DEM", .N, DER_CURR_LEG2]
m$i$bis[ DER_CURR_LEG1== "DEM" & DER_CURR_LEG2== "USD"]
m$i$bis[ DER_CURR_LEG1== "THB" & DER_CURR_LEG2== "USD"]
m$o$bis[ , .N, bss]
m$o$bis[ , crncy1== "THB"]
m$o$bis[ crncy1== "THB",]
m$o$bis[ crncy1== "THB" & crcny2== "USD",]
m$o$bis[ crncy1== "THB" & crncy2== "USD",]
m$o$bis[ crncy1== "THB" & crncy2== "DEM",]
m$o$bis[ crncy1== "DEM" & crncy2== "USD",]
m$o$bis[ crncy1== "DEM", .N, crncy2]
m$o$bis[ crncy1== "THB", .N, crncy2]
m$o$bis[ , .N, crncy2]
m$o$bis[ , .N, crncy2][ order( -N)]
m$o$bis[ crncy1== "GBP", .N, crncy2]
m$o$bis[ cntry== "GB" & crncy1== "GBP", .N, crncy2]
m$o$bis[ crncy1== "GBP", .N, .( cntry, crncy2)]
m$o$bis[ crncy1== "GBP" & crncy2 != "TO1", .N, .( cntry, crncy2)]
m$o$bis
m$o$bis
m$o$bis[ crncy1== "DEM"
m$o$bis[ crncy1== "DEM"]
m$o$bis[ crncy1== "DEM"]
m$o$bis[ crncy1== "DEM", sum( vl), crcny2]
m$o$bis[ crncy1== "DEM", sum( vl), crncy2]
m$o$bis[ crncy1== "DEM", sum( vl, na.rm= T), crncy2]
m$o$bis[ crncy1== "FRF" & , sum( vl, na.rm= T), crncy2]
m$o$bis[ crncy1== "FRF" , sum( vl, na.rm= T), crncy2]
m$o$bis[ crncy1== "FRF" , sum( vl, na.rm= T), .( cntry, crncy2)]
m$o$bis[ crncy1== "FRF" , sum( vl, na.rm= T), .( cntry, crncy2)]
m$o$bis[ crncy2== "FRF" , sum( vl, na.rm= T), .( cntry, crncy2)]
m$o$bis[ crncy2== "BEF" , sum( vl, na.rm= T), .( cntry, crncy2)]
m$o$bis[ crncy1== "BEF" , sum( vl, na.rm= T), .( cntry, crncy2)]
m$o$bis[ crncy1== "DEM" , sum( vl, na.rm= T), .( cntry, crncy2)]
m$o$bis[ crncy1== "FRF" , sum( vl, na.rm= T), .( cntry, crncy2)]
tmp
tmp
tmp
tmp[ crncy1== "DEM"]
m$o$bis[ , .N, .(crncy1, crncy2)]
m$o$bis[ , .N, .(crncy1, crncy2)]
m$o$bis[ , .N, .(crncy1)]
m$o$bis[ , .N, .(crncy1, crncy2)]
m$o$bis[ , .N, .(crncy1, crncy2)][ m$o$bis[ , .N, .(crncy1, crncy2)]]
m$o$bis[ , .N, .(crncy1, crncy2)][ m$o$bis[ , .N, .(crncy1, crncy2)]]
m$o$bis[ , .N, .(crncy1, crncy2)]
m$o$bis[ , .N, .(crncy1, crncy2)][ m$o$bis[ , .N, .(crncy1, crncy2)], on= c( crncy1, crncy2)]
m$o$bis[ , .N, .(crncy1, crncy2)][ m$o$bis[ , .N, .(crncy1, crncy2)], on= c( "crncy1", "crncy2")]
m$o$bis[ crncy2== "EUR", .N, crncy1]
m$o$bis[ crncy2== "EUR" & bss= "Net - net", .N, crncy1]
m$o$bis[ crncy2== "EUR" & bss== "Net - net", .N, crncy1]
m$o$bis[ crncy2== "EUR" & bss== "Net - net", .N, crncy1][ , crncy1]
m$o$bis[ bss== "Net - net" & crncy1 %in% m$o$bis[ crncy2== "EUR" & bss== "Net - net", .N, crncy1][ , crncy1]
]
m$o$bis[ bss== "Net - net" & !crncy1 %in% m$o$bis[ crncy2== "EUR" & bss== "Net - net", .N, crncy1][ , crncy1]]
m$o$bis[ crncy1== "DEM"]
tmp
tmp[ , .N, .( crncy1, crncy2)][ N > 1]
tmp[ , .N, .( crncy1, crncy2)][ N== 1]
tmp[ , .N, .( crncy1, crncy2)][ N== 1]
tmp[ , .N, .( crncy1, crncy2)]
tmp[ , .N, .( crncy1, crncy2)][ , .N, crcny1]
tmp[ , .N, .( crncy1, crncy2)][ , .N, crncy1]
tmp[ , .N, .( crncy1, crncy2)][ , .N, crncy1][ N==2]
tmp[ , .N, .( crncy1, crncy2)][ crncy1== "DKK"]
tmp[ , .N, .( crncy1, crncy2)][ , .N, crncy1][ N==2]
tmp[ , .N, .( crncy1, crncy2)][ crncy1== "HKD"]
tmp[ , .N, .( crncy1, crncy2)][ crncy1== "HUF"]
tmp[ , .N, .( crncy1, crncy2)][ crncy1== "INR"]
tmp[ , .N, .( crncy1, crncy2)][ crncy1== "KRW"]
tmp[ , .N, .( crncy1, crncy2)][ crncy1== "MXN"]
tmp[ , .N, .( crncy1, crncy2)][ crncy1== "RUB"]
tmp[ , .N, .( crncy1, crncy2)][ crncy1== "SGD"]
tmp[ , .N, .( crncy1, crncy2)][ crncy1== "TWD"]
tmp[ , .N, .( crncy1, crncy2)][ N==1]
tmp[ , .N, .( crncy1, crncy2)][ , .N, crncy1][ N==1]
m$o$bis[ yr!= 1986 & crncy1 != "TO1" & crncy2 != "TO1" & instrmnt== "Total (all instruments)" &
	 tnr== "Total (all maturities)" & cntrprt_sctr== "Total (all counterparties)" &
	 cntrprt_cntry== "All countries" & bss== "Net - net" & exctn_mthd== "Total (all methods)"
	& cntry== "5J" & ctgr== "Foreign exchange",
	.( vl= sum( vl, na.rm= T)),
	.( yr, crncy1, crncy2)]
tmp <- m$o$bis[ yr!= 1986 & crncy1 != "TO1" & crncy2 != "TO1" & instrmnt== "Total (all instruments)" &

	 tnr== "Total (all maturities)" & cntrprt_sctr== "Total (all counterparties)" &
	 cntrprt_cntry== "All countries" & bss== "Net - net" & exctn_mthd== "Total (all methods)"
	& cntry== "5J" & ctgr== "Foreign exchange",
	.( vl= sum( vl, na.rm= T)),
	.( yr, crncy1, crncy2)]
tmp
tmp
tmp
tmp[ vl>0]
tmp[ vl==0]
tmp
tmp
)
tmp[ , .N, .( crncy1, crncy2)][ , .( crncy1, crncy2)]
tmp[ , .N, .( crncy1, crncy2)][ , paste0( crncy1, crncy2)]
m$o$crncy_
m$o$crncy_shrs
m$o$bis_crncys
m$o$bis_crncys
))
m$o$crncy_shrs
m$o$bis_crncys
m$o$crncy_shrs
m$o$crncy_shrs[ , .N, crncy1]
m$o$bis_crncys
m$o$bis[ !yr %in% c( 1986, 1989) & crncy1 != "TO1" & instrmnt== "Total (all instruments)" &
	 tnr== "Total (all maturities)" & cntrprt_sctr== "Total (all counterparties)" &
	 cntrprt_cntry== "All countries" & bss== "Net - net" & exctn_mthd== "Total (all methods)"
	& cntry== "5J" & ctgr== "Foreign exchange",
	.( vl= sum( vl, na.rm= T)),
	.( yr, crncy1, ttl= crncy2== "TO1")][
      , .( crncy2= "other", vl= sum( vl* ttl)- sum( vl* (1- ttl))), .( yr, crncy1)]
m$o$crncy_shrs
m$o$crncy_shrs <- m$o$bis[ !yr %in% c( 1986, 1989) & ! paste0( crncy1, crncy2) %in%
                           tmp[ , .N, .( crncy1, crncy2)][ , paste0( crncy1, crncy2)] &
        bss== "Net - gross" & vl > 0,
        .( vl= sum( vl, na.rm= T)),
        .( yr, crncy1, crncy2)][ , .( crncy2, shr= vl/ sum( as.numeric( crncy2== "TO1") * vl)),
                            .( yr, crncy1)]
m$o$crncy_shrs
m$o$crncy_shrs[ crncy1 != "TO1"]
m$o$crncy_shrs
m$o$crncy_shrs
m$o$crncy_shrs[ crncy2== "TO1"]
m$o$crncy_shrs[ , sum( vl) , .( yr, crncy1)]
m$o$crncy_shrs[ , sum( shr) , .( yr, crncy1)]
m$o$crncy_shrs[ , sum( shr)- 1 , .( yr, crncy1)]
m$o$crncy_shrs[ , sum( shr) , .( yr, crncy1)]
m$o$crncy_shrs[ , 1-sum( shr) , .( yr, crncy1)]
m$o$crncy_shrs[ , .( crncy2= "other", 1-sum( shr)) , .( yr, crncy1)]
m$o$crncy_shrs[ , .( sum( shr)) , .( yr, crncy1)]
m$o$crncy_shrs
m$o$crncy_shrs[ , sum( shr), .( yr, crncy1)]
m$o$bis_crncys
m$o$crncy_shrs
m$o$crncy_shrs[ , sum( shr), .( yr, crncy1)]
m$o$crncy_shrs
m$o$bis[ !yr %in% c( 1986, 1989) & ! paste0( crncy1, crncy2) %in%
                           tmp[ , .N, .( crncy1, crncy2)][ , paste0( crncy1, crncy2)] &
                           bss== "Net - gross" & vl > 0 &
                           instrmnt== "Total (all instruments)" &
	 tnr== "Total (all maturities)" & cntrprt_sctr== "Total (all counterparties)" &
	 cntrprt_cntry== "All countries" & exctn_mthd== "Total (all methods)"
	& cntry== "5J" & ctgr== "Foreign exchange"]
m$o$crncy_shrs
m$o$crncy_shrs
m$o$crncy_shrs
m$o$crncy_shrs[ , sum( shr), .( yr, crncy1)]
m$o$bis_crncys[ yr== 1992 & crncy1== "AUD"]
m$o$bis_crncys
m$o$bis[ yr!= 1986 & crncy1 != "TO1" & crncy2 == "TO1" & instrmnt== "Total (all instruments)" &
	 tnr== "Total (all maturities)" & cntrprt_sctr== "Total (all counterparties)" &
	 cntrprt_cntry== "All countries" & bss== "Net - net" & exctn_mthd== "Total (all methods)"
	& cntry== "5J" & ctgr== "Foreign exchange",
	.( vl= sum( vl, na.rm= T)),
	.( yr, crncy1, crncy2)]
m$o$bis[ vl > 0 & !yr %in% c( 1986, 1989) & crncy1 != "TO1" & crncy2 == "TO1" & instrmnt== "Total (all instruments)" &

	 tnr== "Total (all maturities)" & cntrprt_sctr== "Total (all counterparties)" &
	 cntrprt_cntry== "All countries" & bss== "Net - net" & exctn_mthd== "Total (all methods)"

	& cntry== "5J" & ctgr== "Foreign exchange",
	.( vl= sum( vl, na.rm= T)),
	.( yr, crncy1, crncy2)]
m$o$bis_crncys[ , sum( vl), .( yr, crncy1)]
m$o$bis_crncys
m$o$bis_crncys[ , sum( vl), yr]
m$o$bis_crncys[ , sum( vl)/2, yr]
m$o$bis_crncys[ , sum( vl), .( yr)]
m$i$bis
m$i$bis[ yr== 1992, crncy1== "AUD"]
m$i$bis[ yr== 1992 & crncy1== "AUD"]
m$i$bis
m$i$bis[ vl==0]
m$o$bis_crncys
m$o$bis_crncys[ vl ==0]
m$o$bis_crncys[ vl <0]
m$o$bis_crncys[ vl <0]
m$o$bis_crncys[ vl==0]
m$o$bis_crncys[ vl==0]
m$o$bis_crncys[ , .( vl0= sum( vl)), .( yr)]
m$o$bis_crncys[ vl <0]
m$i$bis
m$i$bis[ vl <= 0]
m$x$bis
m$x$bis
m$o$bis
m$x$bis
m$i$bis
m$i$bis[ , .N, crncy2]
m$x$bis[ yr== max( yr)]
m$x$bis
m$x$bis
m$x$crncy_x
m$i$bis
m$i$bis[ , .N, crncy2]
m$x$crncy_x
m$x$bos
m$x$bis
m$x$bis[ , .N, crncy2]
m$i$bis
m$x$bis
m$x$bis[ , levels( crncy2)]
m$x$bis[ , class( crncy2)]
m$x$bis[ , class( crncy2)]
m$x$bis[ , levels( crncy2)]
m$x$bis[ , levels( crncy2)]
m$o$crncy_
m$o$crncy_x
m$o$crncy_x
m$o$crncy_y
m$i$bis[ crncy2== "EUR", .N, crncy1]
m$i$bis[ crncy2== "EUR" & crncy1== "EUR", .N, crncy1]
m$i$bis[ crncy2== "EUR" & crncy1== "EUR", .N, crncy1]
m$o$bis
m$i$bis
m$i$bis[ crcny1== "DEM"]
m$i$bis[ crncy1== "DEM"]
m$i$bis[ crncy1== "GRD"]
m$i$bis[ , max( yr), crncy1]
m$i$bis[ , .( yr= max( yr)), crncy1]
m$i$bis[ , .( yr= max( yr)), crncy1][ yr < 2002]
m$i$bis[ , .( yr= max( yr)), crncy1][ yr < 2002, crncy]
m$i$bis[ , .( yr= max( yr)), crncy1][ yr < 2002, crncy1]
m$o$bis[ yr== 2019]
m$o$bis[ yr== 2019 & is.na( x)]
m$o$bis[ yr== 2019 & is.na( y)]
m$o$bis[ yr== 2019 & is.na( crncy_x)]
m$o$bis[ yr== 2019 & is.na( crncy_y)]
m$o$bis[ yr== 2019] & y <= 0]
m$o$bis[ yr== 2019, y]
m$o$bis[ yr== 2019, .N, y]
m$o$bis[ yr== 2019, .N, x]
m$o$bis[ yr== 2019, .N, crncy_x]
m$o$bis[ yr== 2019, .N, crncy_y]
m$o$bis[ yr== 2019, .N, x]
m$o$crncy_
m$o$crncy_x
m$x$crncy[ , sum( vl), crncy2]
m$x$bis[ , sum( vl), crncy2]
m$x$bis[ , sum( vl), .( yr, crncy2)]
n$o$bis
m$o$bis_crncys
m$o$bis_crncys
m$o$bis_crncys[ , sum( vl), yr]
m$o$crncy_shrs
m$o$crncy_shrs[ , .sum( shr), crncy1]
m$o$crncy_shrs[ , .( sum( shr)), crncy1]
m$o$crncy_shrs[ , .( sum( shr)), crncy1][ order( crncy1)]
m$o$bis[ vl > 0 & !yr %in% c( 1986, 1989) & ! paste0( crncy1, crncy2) %in%
			   tmp[ , .N, .( crncy1, crncy2)][ , paste0( crncy1, crncy2)] &
			   bss== "Net - gross" & vl > 0 &
			   instrmnt== "Total (all instruments)" &
	 tnr== "Total (all maturities)" & cntrprt_sctr== "Total (all counterparties)" &
	 cntrprt_cntry== "All countries" & exctn_mthd== "Total (all methods)"
	 & ctgr== "Foreign exchange"]
m$o$crncy_shrs[ , .( sum( shr)), crncy1][ order( crncy1)]
m$o$bis_crncys[ , .N, .( crncy1, crncy2)][ , paste0( crncy1, crncy2)]
m$o$bis_crncys[ , .N, .( crncy1, crncy2)][ , paste0( crncy1, crncy2)]
m$o$bis[ vl > 0 & !yr %in% c( 1986, 1989) & ! paste0( crncy1, crncy2) %in%
			   m$o$bis_crncys[ , .N, .( crncy1, crncy2)][ , paste0( crncy1, crncy2)] &
			   bss== "Net - gross" & vl > 0 &
			   instrmnt== "Total (all instruments)" &
	 tnr== "Total (all maturities)" & cntrprt_sctr== "Total (all counterparties)" &
	 cntrprt_cntry== "All countries" & exctn_mthd== "Total (all methods)"
	 & ctgr== "Foreign exchange",
	.( vl= sum( vl, na.rm= T)),
	.( yr, crncy1, crncy2)]
m$o$bis[ vl > 0 & !yr %in% c( 1986, 1989) & ! paste0( crncy1, crncy2) %in%
			   m$o$bis_crncys[ , .N, .( crncy1, crncy2)][ , paste0( crncy1, crncy2)] &
			   bss== "Net - gross" & vl > 0 &
			   instrmnt== "Total (all instruments)" &
	 tnr== "Total (all maturities)" & cntrprt_sctr== "Total (all counterparties)" &
	 cntrprt_cntry== "All countries" & exctn_mthd== "Total (all methods)"
	 & ctgr== "Foreign exchange",
	.( vl= sum( vl, na.rm= T)),
	.( yr, crncy1, crncy2)]
m$o$bis[ vl > 0 & !yr %in% c( 1986, 1989) & ! paste0( crncy1, crncy2) %in%
			   m$o$bis_crncys[ , .N, .( crncy1, crncy2)][ , paste0( crncy1, crncy2)] &
			   bss== "Net - gross" & vl > 0 &
			   instrmnt== "Total (all instruments)" &
	 tnr== "Total (all maturities)" & cntrprt_sctr== "Total (all counterparties)" &
	 cntrprt_cntry== "All countries" & exctn_mthd== "Total (all methods)"
	 & ctgr== "Foreign exchange",
	.( vl= sum( vl, na.rm= T)),
	.( yr, crncy1, crncy2)][ , sum( vl), .( yr, crncy1)]
m$o$bis[ vl > 0 & !yr %in% c( 1986, 1989) & ! paste0( crncy1, crncy2) %in%
			   m$o$bis_crncys[ , .N, .( crncy1, crncy2)][ , paste0( crncy1, crncy2)] &
			   bss== "Net - gross" & vl > 0 &
			   instrmnt== "Total (all instruments)" &
	 tnr== "Total (all maturities)" & cntrprt_sctr== "Total (all counterparties)" &
	 cntrprt_cntry== "All countries" & exctn_mthd== "Total (all methods)"
	 & ctgr== "Foreign exchange",
	.( vl= sum( vl, na.rm= T)),
	.( yr, crncy1, crncy2)]
m$o$bis[ vl > 0 & !yr %in% c( 1986, 1989) & ! paste0( crncy1, crncy2) %in%
			   m$o$bis_crncys[ , .N, .( crncy1, crncy2)][ , paste0( crncy1, crncy2)] &
			   bss== "Net - gross" & vl > 0 &
			   instrmnt== "Total (all instruments)" &
	 tnr== "Total (all maturities)" & cntrprt_sctr== "Total (all counterparties)" &
	 cntrprt_cntry== "All countries" & exctn_mthd== "Total (all methods)"
	 & ctgr== "Foreign exchange",
	.( vl= sum( vl, na.rm= T)),
	.( yr, crncy1, crncy2)][ , .( vl= sum( vl)), .( yr, crncy1)][ order( -vl)]
m$o$bis[ vl > 0 & !yr %in% c( 1986, 1989) & ! paste0( crncy1, crncy2) %in%
			   m$o$bis_crncys[ , .N, .( crncy1, crncy2)][ , paste0( crncy1, crncy2)] &
			   bss== "Net - gross" & vl > 0 &
			   instrmnt== "Total (all instruments)" &
	 tnr== "Total (all maturities)" & cntrprt_sctr== "Total (all counterparties)" &
	 cntrprt_cntry== "All countries" & exctn_mthd== "Total (all methods)"
	 & ctgr== "Foreign exchange",
	.( vl= sum( vl, na.rm= T)),
	.( yr, crncy1, crncy2)][ , .( vl= sum( vl)), .( yr, crncy1)][ order( -vl)][ crncy1 != "TO1"]
m$o$bis[ vl > 0 & !yr %in% c( 1986, 1989) & ! paste0( crncy1, crncy2) %in%
			   m$o$bis_crncys[ , .N, .( crncy1, crncy2)][ , paste0( crncy1, crncy2)] &
			   bss== "Net - gross" & vl > 0 &
			   instrmnt== "Total (all instruments)" &
	 tnr== "Total (all maturities)" & cntrprt_sctr== "Total (all counterparties)" &
	 cntrprt_cntry== "All countries" & exctn_mthd== "Total (all methods)"
	 & ctgr== "Foreign exchange",
	.( vl= sum( vl, na.rm= T)),
	.( yr, crncy1, crncy2)][ , .( vl= sum( vl)), .( crncy1)][ order( -vl)][ crncy1 != "TO1"]
m$o$crncy_shrs <- m$o$bis[ vl > 0 & !yr %in% c( 1986, 1989) & ! paste0( crncy1, crncy2) %in%
			   m$o$bis_crncys[ , .N, .( crncy1, crncy2)][ , paste0( crncy1, crncy2)] &
			   bss== "Net - gross" & vl > 0 &
			   instrmnt== "Total (all instruments)" &
	 tnr== "Total (all maturities)" & cntrprt_sctr== "Total (all counterparties)" &
	 cntrprt_cntry== "All countries" & exctn_mthd== "Total (all methods)"
	 & ctgr== "Foreign exchange",
	.( vl= sum( vl, na.rm= T)),
	.( yr, crncy1, crncy2)][ , .( crncy2, shr= vl/ sum( as.numeric( crncy2== "TO1") * vl)),
			    .( yr, crncy1)]
m$o$crncy_shrs[ , .( sum( shr)), .( yr, crncy1)]
m$o$crncy_shrs[ , .( sum( shr)), .( yr, crncy1)][ V1> 2]
m$o$crncy_shrs
m$o$crncy_shrs[ , .( sum( shr)), .( yr, crncy1)]
m$o$crncy_shrs[ , .( sum( shr)), .( yr, crncy1)][ V1> 1]
m$o$crncy_shrs[ , .( sum( shr)), .( yr, crncy1)][ V1< 0]
m$o$bis_crncys
m$o$bis_crncys[ , .( vl= sum( vl)), crncy2]
m$o$bis_crncys[ , .( vl= sum( vl)), crncy2][ order( -N)]
m$o$bis_crncys[ , .( vl= sum( vl)), crncy2][ order( -vl)]
m$o$bis_crncys[ , .( vl= sum( vl)), crncy1][ order( -vl)]
m$i$bis[ , .( sum( vl)), crncy2)]
m$i$bis[ , .( sum( vl)), crncy2]
m$i$bis[ , .( sum( vl)), crncy2][ order( -V1)]
m$i$bis[ crncy2== "other", .( sum( vl)), crncy1][ order( -V1)]
m$o$bis
m$o$bis_crncys[ , sum( vl)/2, yr]
6025279.2/6595471.1
m$o$crncy_shrs
m$o$crncy_shrs[ , .( mean( shr)), crncy1]
m$o$crncy_shrs[ , .( 100*mean( shr)), crncy1]
m$o$bis_crncys
m$o$bis_crncys[ , .N, .(crncy1, crncy2)]
m$o$bis_crncys[ , .N, .(crncy1, crncy2)][ order( -N)]
m$o$bis_crncys[ , .N, .(crncy1, crncy2)][ , .N, crncy1][ order( -N)]
m$o$bis[ !yr %in% c( 1986, 1989) & vl > 0 & crncy1 != "TO1" &
	 instrmnt== "Total (all instruments)" &
	 tnr== "Total (all maturities)" & cntrprt_sctr== "Total (all counterparties)" &
	 cntrprt_cntry== "All countries" & bss== "Net - net" & exctn_mthd== "Total (all methods)" &
	 cntry== "5J" & ctgr== "Foreign exchange",
	.( vl= sum( vl * as.numeric( crncy2== "TO1")- vl * as.numeric( crncy2!= "TO1"), na.rm= T)),
	.( yr, crncy1)]
m$o$crncy_shrs[ , .( 100*mean( shr)), crncy1]
m$o$bis[ !yr %in% c( 1986, 1989) & vl > 0 & crncy1 != "TO1" &
	 instrmnt== "Total (all instruments)" &
	 tnr== "Total (all maturities)" & cntrprt_sctr== "Total (all counterparties)" &
	 cntrprt_cntry== "All countries" & bss== "Net - net" & exctn_mthd== "Total (all methods)" &
	 cntry== "5J" & ctgr== "Foreign exchange",
	.( vl= sum( vl * as.numeric( crncy2== "TO1")- vl * as.numeric( crncy2!= "TO1"), na.rm= T)),
	.( yr, crncy1)]
install.packages( VennDiagram)
install.packages( "VennDiagram")
