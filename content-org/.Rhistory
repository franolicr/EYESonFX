m$i$rts
quartz(); qplot( geom= "line", data= m$i$rts[ , .( N= sum( N)), .( crnc, minute( tm))], x= minute, y= N) + facet_wrap( facets= "crnc", scale= "free_y")
m$x$rts
m$x$rts_wd
dim( m$x$rts_wd)
colnames( m$x$rts_wd)
m$x$rts_wd
m$x$rts_wd[ ,lapply( .SD, is.na)]
m$x$rts_wd[ ,lapply( .SD, function(x) sum( is.na( x)))]
m$x$rts
m$i$rts_wd[ ,lapply( .SD, function(x) sum( is.na( x)))]
m$i$rts[ ,lapply( .SD, function(x) sum( is.na( x)))]
m$i$rts[ ,lapply( .SD, function(x) sum( is.na( x))), crnc]
m$i$rts[ ,lapply( .SD, function(x) sum( is.na( x))), month( tm)]
m$i$rts[ order( crnc, tm)]
m$i$rts[ ,lapply( .SD, function(x) sum( is.na( x))), month( tm)]
m$x$rts[ ,lapply( .SD, function(x) sum( is.na( x))), month( tm)]
m$x$rts
m$x$rts_wd
m$x$rts_wd[ ,lapply( .SD, function(x) sum( is.na( x))), month( tm)]
m$x$rts_wd[ ,lapply( .SD, function(x) sum( is.na( x))),]
m$i$rts_wd[ ,lapply( .SD, function(x) sum( is.na( x))),]
m$i$rts[ ,lapply( .SD, function(x) sum( is.na( x))),]
m$x$rts[ ,lapply( .SD, function(x) sum( is.na( x))),]
m$x$rts[ ,lapply( .SD, function(x) sum( is.na( x))), msr]
m$i$rts
m$i$rts
m$x$rts[ month( tm)== 1, .( sprd= mean( sprd), sd= mean( sd), N= mean( N)), .( crnc, dy, hr)]
m$x$rts[ month( tm)== 1, .( sprd= mean( sprd), sd= mean( sd), N= mean( N)), .( crnc, dy, hr)][ crnc== "EURUSD"]
m$x$rts[ month( tm)== 1, .( sprd= mean( sprd), sd= mean( sd), N= mean( N)), .( crnc, dy, hr)][ crnc== "EUR/USD"]
m$x$rts[ month( tm)== 1, .( sprd= mean( sprd), sd= mean( sd), N= mean( N)), .( crnc, dy, hr)][ crnc== "EUR/USD"][ order( -sprd)]
Sys.date()
Sys.Date()
wday( Sys.Date())
m$x$rts[ month( tm)== 1][ crnc== "EUR/USD"][ order( -sprd)]
m$x$rts[ month( tm)== 1][ crnc== "EUR/USD"][ order( -sprd), .( tm, wday( sprd), sprd)]
m$i$rts
m$x$rts[ !is.na( avg_sprd) & wday( tm)!= 1,
		      .( sprd= mean( avg_sprd), sd= mean( sd_md), N= mean( N)),
		      .( tm= floor_date( tm, "4 hour"), crnc)]

m$x$rts[ !is.na( avg_sprd) & wday( tm)!= 1,
		      .( sprd= mean( avg_sprd), sd= mean( sd_md), N= mean( N)),
		      .( tm= floor_date( tm, "4 hour"), crnc)]

m$i$rts
m$x$rts[ !is.na( avg_sprd) & wday( tm)!= 1,
		      .( sprd= mean( avg_sprd), sd= mean( sd_md), N= mean( N)),

		      .( tm= floor_date( tm, "4 hour"), crnc)]

m$x$rts[ !is.na( avg_sprd) & wday( tm)!= 1,
		      .( sprd= mean( avg_sprd), sd= mean( sd_md), N= mean( N)),
		      .( tm= floor_date( tm, "4 hour"), crnc)]
m$x$rts
m$x$rts[ !is.na( avg_sprd) & wday( tm)!= 1,
		      .( sprd= mean( avg_sprd), sd= mean( sd_md), N= mean( N)),
		      .( tm= floor_date( tm, "4 hour"), crnc)]
m$x$rts[ !is.na( avg_sprd) & wday( tm)!= 1,
		      .( sprd= mean( avg_sprd), sd= sd( log10( avg_md/ shift( avg_md))), N= mean( N)),
		      .( tm= floor_date( tm, "4 hour"), crnc)]
m$x$rts[ !is.na( avg_sprd) & wday( tm)!= 1,
		      .( sprd= mean( avg_sprd), sd= sd( log10( avg_md/ shift( avg_md)), na.rm= T), N= mean( N)),
		      .( tm= floor_date( tm, "4 hour"), crnc)]
m$i$rts
m$i$rts <- NULL
stopCluster()
m$i$rts
as.Date( c( '2020-01-01', '2020-04-10',
                                                     '2020-05-01')
)
m$i$rts[ crnc== "EUR/USD" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd),
                       sprd3= sd( log( avg_md/ shift( avg_md)), na.rm= T)/ sqrt( sum( N)) ),
		     .( tm= floor_date( tm, "day"), crnc)][
                          ! as.Date( tm) %in% as.Date( c( '2020-01-01', '2020-04-10',
                                                     '2020-05-01'))]
m$i$rts[ crnc== "EUR/USD" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd),
                       sprd3= sd( log( avg_md/ shift( avg_md)), na.rm= T)/ sqrt( sum( N)) ),
		     .( tm= floor_date( tm, "day"), crnc)][
                          ! as.Date( tm) %in% as.Date( c( '2020-01-01', '2020-04-10',
                                                     '2020-05-01'))][ order( tm)]
m$i$rts[ crnc== "EUR/USD" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd),
                       sprd3= sd( log( avg_md/ shift( avg_md)), na.rm= T)/ sqrt( sum( N)) ),
		     .( tm= floor_date( tm, "day"), crnc)][
                          !as.Date( tm) %in% as.Date( c( '2020-01-01', '2020-04-10',
                                                     '2020-05-01'))][ order( tm)]
m$i$rts[ crnc== "EUR/USD" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd),
                       sprd3= sd( log( avg_md/ shift( avg_md)), na.rm= T)/ sqrt( sum( N)) ),
		     .( tm= floor_date( tm, "day"), crnc)][
                          !tm %in% as.Date( c( '2020-01-01', '2020-04-10',
                                                     '2020-05-01'))][ order( tm)]
m$i$rts[ crnc== "EUR/USD" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd),
                       sprd3= sd( log( avg_md/ shift( avg_md)), na.rm= T)/ sqrt( sum( N)) ),
		     .( tm= floor_date( tm, "day"), crnc)][
                          tm !%in% as.Date( c( '2020-01-01', '2020-04-10',


m$i$rts[ crnc== "EUR/USD" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd),
                       sprd3= sd( log( avg_md/ shift( avg_md)), na.rm= T)/ sqrt( sum( N)) ),
		     .( tm= floor_date( tm, "day"), crnc)][
                          ! (tm %in% as.Date( c( '2020-01-01', '2020-04-10',
                                                     '2020-05-01')))][ order( tm)]
m$i$rts[ crnc== "EUR/USD" & wday( tm)!= 1, 
m$i$rts[ crnc== "EUR/USD" & wday( tm)!= 1, 
m$i$rts[ crnc== "EUR/USD" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd),
                       sprd3= sd( log( avg_md/ shift( avg_md)), na.rm= T)/ sqrt( sum( N)) ),
		     .( tm= floor_date( tm, "day"), crnc)][
                          order( tm)]
m$i$rts[ crnc== "EUR/USD" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd),
                       sprd3= sd( log( avg_md/ shift( avg_md)), na.rm= T)/ sqrt( sum( N)) ),
		     .( tm= floor_date( tm, "day"), crnc)][
                          order( tm)][ tm== "2020-05-01"]
m$i$rts[ crnc== "EUR/USD" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd),
                       sprd3= sd( log( avg_md/ shift( avg_md)), na.rm= T)/ sqrt( sum( N)) ),
		     .( tm= floor_date( tm, "day"), crnc)][
                          order( tm)][ tm %in% "2020-05-01"]
m$i$rts[ crnc== "EUR/USD" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd),
                       sprd3= sd( log( avg_md/ shift( avg_md)), na.rm= T)/ sqrt( sum( N)) ),
		     .( tm= floor_date( tm, "day"), crnc)][
                          order( tm)][ tm== "2020-05-01"]
m$i$rts[ crnc== "EUR/USD" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd),
                       sprd3= sd( log( avg_md/ shift( avg_md)), na.rm= T)/ sqrt( sum( N)) ),
		     .( tm= floor_date( tm, "day"), crnc)][
                          order( tm)][ tm %in% c( "2020-05-01")]
m$i$rts[ crnc== "EUR/USD" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd),
                       sprd3= sd( log( avg_md/ shift( avg_md)), na.rm= T)/ sqrt( sum( N)) ),
		     .( tm= floor_date( tm, "day"), crnc)][
                          order( tm)][ tm %in% as.Date( c( "2020-05-01"))]
m$i$rts[ crnc== "EUR/USD" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd),
                       sprd3= sd( log( avg_md/ shift( avg_md)), na.rm= T)/ sqrt( sum( N)) ),
		     .( tm= floor_date( tm, "day"), crnc)][
                          order( tm)][ tm %in% as.Date( c( "2020-05-01"))]
as.Date( c( "2020-05-01"))
class( as.Date( c( "2020-05-01")))
m$i$rts[ crnc== "EUR/USD" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd),
                       sprd3= sd( log( avg_md/ shift( avg_md)), na.rm= T)/ sqrt( sum( N)) ),
		     .( tm= floor_date( tm, "day"), crnc)][
                          order( tm)][ tm %in% as.POSIXct( c( "2020-05-01"))]
m$i$rts[ hour( tm) != 22 & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd),
                       sprd3= sd( log( avg_md/ shift( avg_md)), na.rm= T)/ sqrt( sum( N)) ),
		     .( crnc)]
m$i$rts[ crnc== "GBP/JPY" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd),
                       sprd3= sd( log( avg_md/ shift( avg_md)), na.rm= T)/ sqrt( sum( N)) ),
		     .( tm= floor_date( tm, "day"), crnc)][
                        ! as.Date( tm) %in% as.Date( c( '2020-01-01', '2020-04-10',
                                                     '2020-05-01'))]
m$i$rts[ crnc== "GBP/JPY" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd),
                       sprd3= sd( log( avg_md/ shift( avg_md)), na.rm= T)/ sqrt( sum( N)) ),
		     .( tm= floor_date( tm, "day"), crnc)]
m$i$rts[ crnc== "GBP/JPY" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd),
                       sprd3= sd( log( avg_md/ shift( avg_md)), na.rm= T)/ sqrt( sum( N)) ),
		     .( tm= floor_date( tm, "day"), crnc)][ , class( tm)]
m$i$rts[ crnc== "GBP/JPY" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd),
                       sprd3= sd( log( avg_md/ shift( avg_md)), na.rm= T)/ sqrt( sum( N)) ),
		     .( tm= floor_date( tm, "day"), crnc)][ , as.Date( tm)]
m$i$rts[ crnc== "GBP/JPY" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd),
                       sprd3= sd( log( avg_md/ shift( avg_md)), na.rm= T)/ sqrt( sum( N)) ),
		     .( tm= floor_date( tm, "day"), crnc)][ order( tm), as.Date( tm)]
m$i$rts[ crnc== "GBP/JPY" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd),
                       sprd3= sd( log( avg_md/ shift( avg_md)), na.rm= T)/ sqrt( sum( N)) ),
		     .( tm= floor_date( tm, "day"), crnc)][ , tm]
m$i$rts[ crnc== "GBP/JPY" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd),
                       sprd3= sd( log( avg_md/ shift( avg_md)), na.rm= T)/ sqrt( sum( N)) ),
		     .( tm= floor_date( tm, "day"), crnc)][ , order( tm)]
m$i$rts[ crnc== "GBP/JPY" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd),
                       sprd3= sd( log( avg_md/ shift( avg_md)), na.rm= T)/ sqrt( sum( N)) ),
		     .( tm= floor_date( tm, "day"), crnc)][ order( tm), tm]
)
m$i$rts[ crnc== "GBP/JPY" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd),
                       sprd3= sum( N))),
		     .( tm= floor_date( tm, "day"), crnc)]
m$i$rts[ crnc== "GBP/JPY" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd),
		     .( cut( sum( N), breaks= 10)), crnc)]
m$i$rts[ crnc== "GBP/JPY" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd),
		     .( vlm= cut( sum( N), breaks= 10)), crnc)]
m$i$rts[ crnc== "GBP/JPY" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd),
		     .( vlm= cut( sum( N), breaks= 10)), crnc)]
m$i$rts[ crnc== "GBP/JPY" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd),
		     .( vlm= cut( sum( N), breaks= 10), crnc)]
m$i$rts[ crnc== "GBP/JPY" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd)),
		     .( vlm= cut( sum( N), breaks= 10, ordered_result= T), crnc)]
m$i$rts[ crnc== "GBP/JPY" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd)),
		     .( vlm= cut( sum( N), breaks= 10, ordered_result= T), crnc)]
m$i$rts[ crnc== "GBP/JPY" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd), N= sum( N)),
		     .( floor_date( tm, "1 hour"))]
m$i$rts[ crnc== "GBP/JPY" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd), N= sum( N)),
		     .( floor_date( tm, "1 hour"))][ , .( sprd= mean( sprd)), cut( N, breaks= 10)]
m$i$rts[ crnc== "GBP/JPY" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd), N= sum( N)),
		     .( floor_date( tm, "1 hour"))][ , .( sprd= mean( sprd)), cut( N, breaks= 20)]
m$i$rts[ crnc== "GBP/JPY" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd), N= sum( N)),
		     .( floor_date( tm, "1 hour"))][ , .( sprd= mean( sprd)), cut( N, breaks= 20, ordered_result= T)]
m$i$rts[ crnc== "GBP/JPY" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd), N= sum( N)),
		     .( floor_date( tm, "1 hour"))][ , .( sprd= mean( sprd)), cut( N, breaks= 20, ordered_result= T)]
m$i$rts[ crnc== "GBP/USD" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd), N= sum( N)),
		     .( floor_date( tm, "1 hour"))][ , .( sprd= mean( sprd)), cut( N, breaks= 20, ordered_result= T)]
?cut
m$i$rts
m$i$rts[ crnrc== "GBP/JPY"]
m$i$rts[ crnc== "GBP/JPY"]
)
)
m$i$rts[ crnc== "EUR/USD" & wday( tm)!= 1, 
		     .( sprd= mean( avg_sprd),
                       sprd3= sd( log( avg_md/ shift( avg_md)), na.rm= T)/ sqrt( sum( N)) ),
		     .( tm= floor_date( tm, "hour"), hr= hour( tm), crnc)][
                        ! floor_date( tm) %in% as.POSIXct( c( '2020-01-01', '2020-04-10',
                                                     '2020-05-01'))]
m$i$rts
m$i$dks_rts <- fread( file= "~/Dnk/Srcs/Dks_Cpy/Extrct/EURUSD-2020_05_08-2020_05_08.csv")
m$i$dks_rts
setnames( m$i$dks_rts, c( "tm", "bd", "ofr", "bd_vlm", "ofr_vlm"))
m$i$dks_rts[ , `:=`( tm= fastPOSIXct( tm))]
m$i$dks_rts
list.files()
list.files( path= "~/Dnk/Srcs/Dks_Cpy/Extrct/EURUSD-2020_05_08-2020_05_08.csv")
list.files( path= "~/Dnk/Srcs/Dks_Cpy/Extrct/")
m$i$dks_rts <- fread( file= "~/Dnk/Srcs/Dks_Cpy/Extrct/GPBUSD-2020_05_06-2020_05_06.csv")
m$i$dks_rts <- fread( file= "~/Dnk/Srcs/Dks_Cpy/Extrct/GBPUSD-2020_05_06-2020_05_06.csv")
setnames( m$i$dks_rts, c( "tm", "bd", "ofr", "bd_vlm", "ofr_vlm"))
m$i$dks_rts[ , `:=`( tm= fastPOSIXct( tm))]
m$i$dks_rts[ , .( sprd= mean( bd- ofr), floor_date( tm, "5 minute"))]
quartz(); qplot( data= m$i$dks_rts[ , .( sprd= mean( bd- ofr), .( tm= floor_date( tm, "5 minute")))], x= tm, y= sprd)
quartz(); qplot( data= m$i$dks_rts[ , .( sprd= mean( bd- ofr)), .( tm= floor_date( tm, "5 minute"))], x= tm, y= sprd)
quartz(); qplot( data= m$i$dks_rts[ , .( sprd= mean( bd- ofr)), .( tm= floor_date( tm, "5 minute"))], x= tm, y= sprd) + scale_x_datetime( date_break= "hour")
quartz(); qplot( data= m$i$dks_rts[ , .( sprd= mean( bd- ofr)), .( tm= floor_date( tm, "5 minute"))], x= tm, y= sprd) + scale_x_datetime( date_break= "hour", date_labels= "hour")
quartz(); qplot( data= m$i$dks_rts[ , .( sprd= mean( bd- ofr)), .( tm= floor_date( tm, "5 minute"))], x= tm, y= sprd) + scale_x_datetime( date_break= "hour", date_labels= "%H")
quartz(); qplot( data= m$i$dks_rts[ , .( sprd= mean( bd- ofr)), .( tm= floor_date( tm, "5 minute"))], x= tm, y= sprd) + scale_x_datetime( date_break= "hour", date_labels= "%H")
quartz(); qplot( data= m$i$dks_rts[ , .( sprd= mean( bd- ofr)), .( tm= floor_date( tm, "5 minute"))], x= tm, y= sprd) + scale_x_datetime( date_break= "hour", date_labels= "%H")
m$i$rts[ day( tm)== 35, 
		     .( avg_sprd, tm, crnc)]
m$i$rts[ day( tm)== 34, 

		     .( avg_sprd, tm, crnc)]
m$x$rts
m$x$rts
m$x$rts
m$i$rts
m$x$rts
m$f$lm
summary( m$f$lm)
m$f$lm
str( m$f$lm)
m$f$lm$fitted.values
m$f$lm$fitted.values
str( m$f$lm)
m$o$rts
m$x$rts
m$o$rts[ , .( tm, sprd)]
m$x$rts
 m$i$rts[ order( crnc, tm)]
)
m$i$rts
m$i$rts[ hour( tm) != 22 & wday( tm)!= 1,
		     .( sprd= mean( avg_sprd), mnth= month( tm),
                       sprd3= sd( log( avg_md/ shift( avg_md)), na.rm= T)),
		     .( crnc)]
m$i$dks_rts
install.packages('bit64')
m$p$crncs
m$p$crncs
m$p$crncs[ 1]
m$p$crncs[[ 1]]
x= m$p$crncs[[1]]
x
m$i$rts
m$i$trfx_rts
m$i$trfx_rts[ , .N, lst_sprd]
m$i$trfx_rts[ , .N, .( crnc, lst_sprd)]
m$i$trfx_rts[ crnc== "EUR/USD", .N, .( crnc, lst_sprd)]
m$i$trfx_rts[ crnc== "EUR/USD", .N, .( crnc, lst_sprd)][ order( lst_sprd)]
m$i$dks_rts[ crnc== "EUR/USD", .N, .( crnc, bd- ofr)][ order( lst_sprd)]
m$i$dks_rts[ crnc== "EUR/USD", .N, .( bd- ofr)][ order( lst_sprd)]
m$i$dks_rts[ , .N, .( bd- ofr)][ order( lst_sprd)]
m$i$dks_rts[ , .N, .( sprd= bd- ofr)][ order( sprd)]
m$i$dks_rts[ crnc== "EUR/USD", .N, .( bd- ofr)][ order( lst_sprd), .( sprd, N/ sum( N), N)][1:10]
m$i$dks_rts[ , .N, .( sprd= bd- ofr)][ order( sprd), .( sprd, N, N/ sum( N))]
m$i$dks_rts[ , .N, .( sprd= bd- ofr)][ order( sprd)[1:10], .( sprd, N, N/ sum( N))]
m$i$dks_rts[ , .N, .( sprd= bd- ofr)][ order( sprd)[1:10], .( sprd, N, cumsum( N/ sum( N)))]
m$i$dks_rts[ , .N, .( sprd= bd- ofr)][ order( sprd), .( sprd, N, cumsum( N/ sum( N)))][1:10]
m$i$trfx_rts[ crnc== "EUR/USD", .N, .( crnc, lst_sprd)][ order( lst_sprd)][1:10]
m$i$trfx_rts
m$i$trfx_rts[ crnc== "EUR/USD", .N, .( crnc, lst_sprd)][ order( lst_sprd)][1:10]
m$i$dks_rts[ , .N, .( sprd= bd- ofr)][ order( sprd), .( sprd, N, cumsum( N/ sum( N)))][1:10]
m$i$dks_rts[ , .N, .( sprd= round( bd- ofr, 5))][ order( sprd), .( sprd, N, cumsum( N/ sum( N)))][1:10]
m$i$trfx_rts[ crnc== "EUR/USD", .N, .( crnc, round( lst_sprd, 5))][ order( lst_sprd)][1:10]
m$i$trfx_rts[ crnc== "EUR/USD", .N, .( crnc, lst_sprd)][ order( lst_sprd)][1:10]
m$i$trfx_rts[ crnc== "EUR/USD", .N, .( crnc, lst_sprd= round( lst_sprd, 5))][ order( lst_sprd)][1:10]
m$i$dks_rts[ , .N, .( sprd= round( bd- ofr, 5))][ order( sprd), .( sprd, N, cumsum( N/ sum( N)))][1:10]
m$i$dks_rts[ , .N, .( sprd= round( bd- ofr, 5))][ order( sprd), .( sprd, N, prcnt= N/ sum( N), cm_prcnt= cumsum( N/ sum( N)))][1:10]
m$i$trfx_rts[ crnc== "EUR/USD", .N, .( crnc, lst_sprd= round( lst_sprd, 5))][ order( lst_sprd), .( sprd, N, prcnt= N/ sum( N), cm_prcnt= cumsum( N/ sum( N)))][1:10]
m$i$trfx_rts[ crnc== "EUR/USD", .N, .( crnc, sprd= round( lst_sprd, 5))][ order( sprd), .( sprd, N, prcnt= N/ sum( N), cm_prcnt= cumsum( N/ sum( N)))][1:10]
m$i$dks_rts[ , .N, .( sprd= round( bd- ofr, 5))][ order( sprd), .( sprd, N, prcnt= N/ sum( N), cm_prcnt= cumsum( N/ sum( N)))][1:10]
m$i$dks_rts
m$i$dks_rts[ , .( sprd= mean( bd- ofr)), floor_date( tm, "5 min")] 
qplot( data= m$i$dks_rts[ , .( sprd= mean( bd- ofr)), floor_date( tm, "5 min")], x= tm, y= sprd)
library( ggplot2)
qplot( data= m$i$dks_rts[ , .( sprd= mean( bd- ofr)), floor_date( tm, "5 min")], x= tm, y= sprd)
qplot( data= m$i$dks_rts[ , .( sprd= mean( bd- ofr)), .( tm= floor_date( tm, "5 min"))], x= tm, y= sprd)
quartz(); qplot( data= m$i$trfx_rts[ , .( sprd= mean( bd- ofr)), .( tm= floor_date( tm, "5 min"))], x= tm, y= sprd)
quartz(); qplot( data= m$i$trfx_rts[ crnc== "EUR/USD" & as.Date( tm)== "2020-04-24" , .( sprd= mean( bd- ofr)), .( tm= floor_date( tm, "5 min"))], x= tm, y= sprd)
quartz(); qplot( data= m$i$trfx_rts[ crnc== "EUR/USD" & as.Date( tm)== "2020-04-24" , .( sprd), .( tm= floor_date( tm, "5 min"))], x= tm, y= sprd)
m$i$rts
m$i$trfx_rts
quartz(); qplot( data= m$i$trfx_rts[ crnc== "EUR/USD" & as.Date( tm)== "2020-04-24" , .( sprd= lst_sprd), .( tm= floor_date( tm, "5 min"))], x= tm, y= sprd)
qplot( data= m$i$trfx_rts[ crnc== "EUR/USD" & as.Date( tm)== "2020-04-24" , .( sprd= lst_sprd), .( tm= floor_date( tm, "5 min"))], x= tm, y= sprd) + scale_y_continuous( limits= c( 0, 0.00025))
m$i$dks_rts[ , .N, .( sprd= round( bd- ofr, 5))][ order( sprd), .( sprd, N, prcnt= N/ sum( N), cm_prcnt= cumsum( N/ sum( N)))][1:10]
m$i$trfx_rts[ crnc== "EUR/USD", .N, .( crnc, sprd= round( lst_sprd, 5))][ order( sprd), .( sprd, N, prcnt= N/ sum( N), cm_prcnt= cumsum( N/ sum( N)))][1:10]
qplot( data= m$i$trfx_rts[ crnc== "EUR/USD" & as.Date( tm)== "2020-04-24" , .( sprd= lst_sprd), .( tm= floor_date( tm, "5 min"))], x= tm, y= sprd) + scale_y_continuous( limits= c( 0.00001, 0.00025))
qplot( data= m$i$trfx_rts[ crnc== "EUR/USD" & as.Date( tm)== "2020-04-24" , .( sprd= lst_sprd), .( tm= floor_date( tm, "5 min"))], x= tm, y= sprd) + scale_y_continuous( limits= c( 0.00002, 0.00025))
m$i$trfx_rts[ crnc== "EUR/USD", .N, .( crnc, sprd= round( lst_sprd, 5))][ order( sprd), .( sprd, N, prcnt= N/ sum( N), cm_prcnt= cumsum( N/ sum( N)))][1:10]
m$i$dks_rts[ , .N, .( sprd= round( bd- ofr, 5))][ order( sprd), .( sprd, N, prcnt= N/ sum( N), cm_prcnt= cumsum( N/ sum( N)))][1:10]
qplot( data= m$i$trfx_rts[ crnc== "EUR/USD" & as.Date( tm)== "2020-04-24" , .( sprd= lst_sprd), .( tm= floor_date( tm, "5 min"))], x= tm, y= sprd) + scale_y_continuous( limits= c( 0.00001, 0.00025))
qplot( data= m$i$trfx_rts[ crnc== "EUR/USD" & as.Date( tm)== "2020-04-24" , .( sprd= mean( lst_sprd)), .( tm= floor_date( tm, "5 min"))], x= tm, y= sprd) + scale_y_continuous( limits= c( 0.00001, 0.00025))
qplot( data= m$i$trfx_rts[ crnc== "EUR/USD" & as.Date( tm)== "2020-04-24" , .( sprd= mean( lst_sprd)), .( tm= floor_date( tm, "5 min"))], x= tm, y= sprd) + scale_y_continuous( limits= c( 0.00002, 0.00025))
qplot( data= m$i$trfx_rts[ crnc== "EUR/USD" & as.Date( tm)== "2020-04-24" , .( sprd= mean( lst_sprd)), .( tm= floor_date( tm, "5 min"))], x= tm, y= sprd) 
qplot( data= m$i$trfx_rts[ crnc== "EUR/USD" & as.Date( tm)== "2020-04-24" , .( sprd= mean( lst_sprd)), .( tm= floor_date( tm, "5 min"))], x= tm, y= sprd) + scale_x_continuous( limit= c( 0, 0.00025)
)
qplot( data= m$i$trfx_rts[ crnc== "EUR/USD" & as.Date( tm)== "2020-04-24" , .( sprd= mean( lst_sprd)), .( tm= floor_date( tm, "5 min"))], x= tm, y= sprd) + scale_y_continuous( limit= c( 0, 0.00025))
m$i$dks_rts
install.packages( "randomForest")
install.packages( "randomForest")
install.packages('bit64')
m$i$dks_rts
m$p$tck_br_n
m$p$tck_br_n
?shift
m$x$dks_rts
m$x$dks_rts[ , .( tm, bd, bd_vlm, bd_trd_vlm)] 
m$x$dks_rts[ , .( tm, bd, bd_vlm, bd_trd_vlm)] 
m$x$dks_rts[ , .( tm, bd, bd_vlm, bd_trd_vlm)] 
m$x$dks_rts[ , .( tm, bd, bd_vlm, bd_trd_vlm)][ 1:20]
m$x$dks_rts[ , .( tm, bd, nxt_bd, bd_vlm, bd_trd_vlm)][ 1:20]
m$x$dks_rts[ order( tm), .( tm, bd, nxt_bd, bd_vlm, bd_trd_vlm)][ 1:20]
m$x$dks_rts[ order( tm), .( tm, bd, bd_vlm, bd_trd_vlm)][ 1:20]
m$x$dks_rts[ order( tm), .( tm, bd, bd_vlm, bd_trd_vlm)][ 1:40]
m$x$dks_rts[ order( tm), .( tm, bd, bd_vlm, bd_trd_vlm, ofr, ofr_vlm, ofr_trd_vlm)][ 1:40]
m$x$dks_rts
m$p$vlm_ordr_br
m$x$rts
m$x$dks_rts
m$x$dks_rts
m$x$dks_rts[ , .( vlm= sum( bd_trd_vlm + ofr_trd_vlm)), mnt]
m$x$dks_rts[ , .( vlm= sum( bd_trd_vlm + ofr_trd_vlm)), mnt]
m$p$vlm_trd_br
m$p$vlm_ordr_br
m$p$vlm_trd_br * 1440
m$p$vlm_trd_br * 1440 / 1e9
m$p$vlm_trd_br
m$x$dks_rts
m$x$dks_rts
m$x$dks_rts
m$x$dks_rts
m$f$rf
m$f$rf
?randomForest
m$f$rf
install.packages( "caret")
library( caret)
install.packages( "Boruta")
qplot( data= m$i$dks_rts[ , .( sprd= mean( bd- ofr)), .( tm= floor_date( tm, "5 min"))], x= tm, y= sprd) 
quartz(); qplot( data= m$i$dks_rts[ , .( sprd= mean( bd- ofr)), .( tm= floor_date( tm, "5 min"))], x= tm, y= sprd) 
m$i$trfx_rts
quartz(); qplot( data= m$i$dks_rts[ , .( sprd= mean( bd- ofr)), .( tm= floor_date( tm, "5 min"))], x= tm, y= sprd) 
m$i$trfx_rts
m$i$trfx_rts
m$i$trfx_rts
m$i$rts
quartz(); qplot( data= m$i$rts[ as.Date( tm)== "2020-01-17"], .( sprd= mean( bd- ofr)), .( tm= floor_date( tm, "5 min"))], x= tm, y= avg_sprd) 
qplot( data= m$i$rts[ as.Date( tm)== "2020-01-17"], x= tm, y= avg_sprd) 
qplot( data= m$i$rts[ as.Date( tm)== "2020-01-17" & crnc== "EUR/USD"], x= tm, y= avg_sprd) 
quartz(); qplot( data= m$i$rts[ crnc== "EUR/USD", .( dt= as.Date( tm), avg_sprd, tm) ], x= tm, y= avg_sprd) + facet_wrap( "dt") + scale_x_datetime( data_breaks= "1 hour", date_labels= "%H")
quartz(); qplot( data= m$i$rts[ crnc== "EUR/USD", .( dt= as.Date( tm), avg_sprd, tm) ], x= tm, y= avg_sprd) + facet_wrap( "dt") + scale_x_datetime( date_breaks= "1 hour", date_labels= "%H")
m$i$rts[ crnc== "EUR/USD", .( dt= as.Date( tm), avg_sprd, tm) ]
quartz(); qplot( data= m$i$rts[ crnc== "EUR/USD", .( dt= as.Date( tm), avg_sprd, tm) ], x= tm, y= avg_sprd) + facet_wrap( facets= "dt")
quartz(); qplot( data= m$i$rts[ crnc== "EUR/USD", .( dt= as.Date( tm), avg_sprd, tm) ], x= tm, y= avg_sprd) + facet_wrap( "dt", scales= "free_x") + scale_x_datetime( date_breaks= "1 hour", date_labels= "%H")
qplot( data= m$i$rts[ crnc== "EUR/USD", .( dt= as.Date( tm), avg_sprd, tm= as.hms( tm) ], x= tm, y= avg_sprd, colour= wday( dt)) + facet_wrap( "dt") + scale_x_datetime( date_breaks= "1 hour", date_labels= "%H")
qplot( data= m$i$rts[ crnc== "EUR/USD", .( dt= as.Date( tm), avg_sprd, tm= as.hms( tm)) ], x= tm, y= avg_sprd, colour= wday( dt)) + facet_wrap( "dt") + scale_x_datetime( date_breaks= "1 hour", date_labels= "%H")
qplot( data= m$i$rts[ crnc== "EUR/USD", .( dt= as.Date( tm), avg_sprd, tm= as_hms( tm)) ], x= tm, y= avg_sprd, colour= wday( dt)) + facet_wrap( "dt") + scale_x_datetime( date_breaks= "1 hour", date_labels= "%H")
library( hms)
qplot( data= m$i$rts[ crnc== "EUR/USD", .( dt= as.Date( tm), avg_sprd, tm= as_hms( tm)) ], x= tm, y= avg_sprd, colour= wday( dt)) + facet_wrap( "dt") + scale_x_datetime( date_breaks= "1 hour", date_labels= "%H")
qplot( data= m$i$rts[ crnc== "EUR/USD", .( dt= as.Date( tm), avg_sprd, tm= as_hms( tm)) ], x= tm, y= avg_sprd, colour= wday( dt)) + facet_wrap( "dt") 
qplot( data= m$i$rts[ crnc== "EUR/USD", .( dt= as.Date( tm), avg_sprd, tm= as_hms( tm)) ], x= tm, y= avg_sprd, colour= factor( wday( dt))) + facet_wrap( "dt", ncol= 12) 
m$p$cls_urls
tmp <- fread( "/Dnk/Srcs/CLS/Extrct/cls_vlms.csv")
tmp <- fread( "~/Dnk/Srcs/CLS/Extrct/cls_vlms.csv")
m$p$cls_urls
m$x$cls
m$x$cls[ instrmnt== "Swap", .( mnth, value, qtr_end= month( mnth) %% 3== 0)]
qplot( data= m$x$cls[ instrmnt== "Swap", .( mnth, value, qtr_end= month( mnth) %% 3== 0)], x= mnth, y= value, colour= qtr_end)
qplot( data= m$x$cls[ instrmnt== "Swap", .( mnth, value, qtr_end= month( mnth) %% 3== 0)], x= mnth, y= value, colour= qtr_end) + geom_line()
qplot( data= m$x$cls[ instrmnt== "Swap", .( mnth, value, qtr_end= month( mnth) %% 3== 0)], x= mnth, y= value, geom= "line") + geom_point( mapping= aes( x= mnth, y= value, colour= qtr_end)
)
qplot( data= m$x$cls[ instrmnt== "Swap", .( mnth, value, qtr_end= month( mnth) %% 3== 0)], x= mnth, y= value, geom= "line") 
m$x$cls[ instrmnt== "Swap", .( mnth, value, qtr_end= month( mnth) %% 3== 0)]
m$x$cls[ instrmnt== "Swap", .( mean( value)), .( mnth, qtr_end= month( mnth) %% 3== 0)]
m$x$cls[ instrmnt== "Swap", .( mean( as.numeric( value))), .( mnth, qtr_end= month( mnth) %% 3== 0)]
qplot( data= m$x$cls[ instrmnt== "Swap", .( mean( as.numeric( value))), .( mnth, qtr_end= month( mnth) %% 3== 0)], x= mnth, y= value, geom= "line") 
qplot( data= m$x$cls[ instrmnt== "Swap", .( value= mean( as.numeric( value))), .( mnth, qtr_end= month( mnth) %% 3== 0)], x= mnth, y= value, geom= "line") 
qplot( data= m$x$cls[ instrmnt== "Swap", .( value= mean( as.numeric( value))), .( mnth, qtr_end= month( mnth) %% 3== 0)], x= mnth, y= value, geom= "line") + geom_point( mapping= aes( colour= qtr_end))
m$o$dks_rts
m$o$dks_rts
?shift
m$o$dks_rts
m$o$dks_rts[ , .( sprd, bd_chng, sgnd_ordr_vlm,
                                         ofr_chng, ofr_mx_mn, bd_mx_mn,
                                         shift( bd_mx_mn, 1:15, fill= 0, give.names= T),
                                         ordr_vlm, trd_vlm)]
m$o$dks_rts[ , .( sprd, bd_chng, sgnd_ordr_vlm,
                                         ofr_chng, ofr_mx_mn, bd_mx_mn,
                                         shift( bd_mx_mn, 1:15, fill= 0, give.names= T),
                                         ordr_vlm, trd_vlm)]
m$o$dks_rts[ , .( sprd, bd_chng, sgnd_ordr_vlm,
                                         ofr_chng, ofr_mx_mn, bd_mx_mn,
                                         shift( bd_mx_mn, 1:15, fill= 0),
                                         ordr_vlm, trd_vlm)]
?shift
m$o$dks_rts[ , .( 
                                         shift( bd_mx_mn, 1:15, fill= 0)]
m$o$dks_rts[ , .( 
                                         shift( bd_mx_mn, 1:10, fill= 0))]
m$o$dks_rts[ , .( sprd, bd_chng, sgnd_ordr_vlm,
                                         ofr_chng, ofr_mx_mn, bd_mx_mn,
                                         shift( bd_mx_mn, 1:15, fill= 0),
                                         ordr_vlm, trd_vlm)]
m$o$dks_rts[ , cbind( sprd, shift( .SD)), .SDcols= 2:8]
m$o$dks_rts[ , shift( .SD), .SDcols= 2:8]
m$o$dks_rts[ , .( sprd, shift( .SD)), .SDcols= 2:8]
m$o$dks_rts[ , cbind( sprd, shift( .SD)), .SDcols= 2:8]
m$o$dks_rts
m$o$dks_rts[ , -(1: 2)]
names( m$o$dks_rts[ , -(1: 2)])
names( m$o$dks_rts[ , -(1: 2)]) %x% 1:2
names( m$o$dks_rts[ , -(1: 2)]) %*% 1:2
?paste
c( names( m$o$dks_rts[ , -(1: 2)]) %*% 1:2, 1:2)
c( names( m$o$dks_rts[ , -(1: 2)]) , 1:2)
lapply( names( m$o$dks_rts[ , -(1: 2)]), c, 1:2)
 m$o$dks_rts[ , -(1: 2)]
 m$o$dks_rts[ , -(1: 2)][ 1:15]
 m$o$dks_rts[ , -(1: 2)][ 1:15][ , paste( .SD, I)]
 m$o$dks_rts[ , -(1: 2)][ 1:15][ , colname( .SD)]
 m$o$dks_rts[ , -(1: 2)][ 1:15][ , names( .SD)]
 m$o$dks_rts[ , -(1: 2)][ 1:15, cbind( .I, .SD)]
 m$o$dks_rts[ , -(1: 2)][ 1:15, cbind( .I, .SD)][ , paste( names( .SD), I)]
 m$o$dks_rts[ , -(1: 2)][ 1:15, cbind( .I, .SD)][ , paste( names( .SD))]
 m$o$dks_rts[ , -(1: 2)][ 1:15, cbind( .I, .SD)]
 m$o$dks_rts[ , -(1: 2)][ 1:15, cbind( .I, .SD)][ , names( .SD)]
 m$o$dks_rts[ , -(1: 2)][ 1:15, paste( names( .SD), .I)]
 m$o$dks_rts[ , -(1: 2)][ 1:15, .( paste( names( .SD), .I))]
 m$o$dks_rts[ , -(1: 2)][ , shift( .SD, 1:2, give.names= T)]
 m$o$dks_rts[ , -(1: 2)][ , shift( .SD, 1:10, give.names= T)]
 m$o$dks_rts[ , -(1: 2)][ , shift( .SD, 1:10, give.names= T)]
m$f$brt
?save
m$f$brt
m$o$dks_rts
m$o$dks_rts[ , -(1: 2)][ , shift( .SD, 0:10, fill= 0, give.names= T)]
m$o$dks_rts[ , -(1: 2)][ , shift( .SD, 0:10, fill= 0, give.names= T)]
m$f$brt
str(m$f$brt)
m$f$brt$finalDecision
m$f$brt
str(m$f$brt)
m$f$brt$ImpHistory
attStats( TentativeRoughFix( m$f$brt))
attStats( TentativeRoughFix( m$f$brt))
attStats( TentativeRoughFix( m$f$brt))$meanImp
class( attStats( TentativeRoughFix( m$f$brt)))
 attStats( TentativeRoughFix( m$f$brt)))[ , "meanImp"]
as.data.table( attStats( TentativeRoughFix( m$f$brt)))[ , "meanImp"]
as.data.table( attStats( TentativeRoughFix( m$f$brt)))[ , meanImp]
as.data.table( attStats( TentativeRoughFix( m$f$brt)))
as.data.table( attStats( TentativeRoughFix( m$f$brt)), keep.rownames= T)
as.data.table( attStats( TentativeRoughFix( m$f$brt)), keep.rownames= T)[ , .( rn, meanImp)]
as.data.table( attStats( TentativeRoughFix( m$f$brt)), keep.rownames= T)[ -order( meanImp), .( rn, meanImp)]
as.data.table( attStats( TentativeRoughFix( m$f$brt)), keep.rownames= T)[ order( meanImp), .( rn, meanImp)]
as.data.table( attStats( TentativeRoughFix( m$f$brt)), keep.rownames= T)[ order( -meanImp), .( rn, meanImp)]
as.data.table( attStats( TentativeRoughFix( m$f$brt)), keep.rownames= T)[ order( -meanImp), .( rn, meanImp)][ 1:20]
